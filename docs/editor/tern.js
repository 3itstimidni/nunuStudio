!function(e,t){"object"==typeof exports&&"object"==typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e.tern||(e.tern={})).signal={})}(this,(function(e){function t(e,t){var r=this._handlers||(this._handlers=Object.create(null));(r[e]||(r[e]=[])).push(t)}function r(e,t){var r=this._handlers&&this._handlers[e];if(r)for(var n=0;n<r.length;++n)if(r[n]==t){r.splice(n,1);break}}var n=[];function i(e,t){var r=e._handlers&&e._handlers[t];return r&&r.length?r.slice():n}function o(e,t,r,n,o){for(var s=i(this,e),a=0;a<s.length;++a)s[a].call(this,t,r,n,o)}function s(e,t,r,n,o){for(var s=i(this,e),a=0;a<s.length;++a){var p=s[a].call(this,t,r,n,o);if(p)return p}}function a(e){var t=this._handlers&&this._handlers[e];return t&&t.length>0&&t}e.mixin=function(e){return e.on=t,e.off=r,e.signal=o,e.signalReturnFirst=s,e.hasHandler=a,e}})),function(e,t){"object"==typeof exports&&"object"==typeof module?t(exports,require("./infer"),require("./signal"),require("acorn"),require("acorn-walk")):"function"==typeof define&&define.amd?define(["exports","./infer","./signal","acorn/dist/acorn","acorn-walk/dist/walk"],t):t(e.tern||(e.tern={}),tern,tern.signal,acorn,acorn.walk)}(this,(function(e,t,r,n,i){"use strict";var o=Object.create(null);e.registerPlugin=function(e,t){o[e]=t};var s=e.defaultOptions={debug:!1,async:!1,getFile:function(e,t){this.async&&t(null,null)},normalizeFilename:function(e){return e},defs:[],plugins:{},fetchTimeout:1e3,dependencyBudget:2e4,reuseInstances:!0,stripCRs:!1,ecmaVersion:9,projectDir:"/",parent:null},a={completions:{takesFile:!0,run:function(e,r,i){if(null==r.end)throw v("missing .query.end field");var o=e.signalReturnFirst("completion",i,r);if(o)return o;for(var s=T(i,r.end),a=s,p=i.text;s&&n.isIdentifierChar(p.charCodeAt(s-1));)--s;if(!1!==r.expandWordForward)for(;a<p.length&&n.isIdentifierChar(p.charCodeAt(a));)++a;var u,f,l,c,h=p.slice(s,a),d=[];function g(t,n,i,o){if((!m&&!1===r.omitObjectPrototype||n!=e.cx.protos.Object||h)&&!(!1!==r.filter&&h&&0!==(r.caseInsensitive?t.toLowerCase():t).indexOf(h)||u&&u.props[t])){var s=D(r,d,t,n&&n.props[t],i);o&&s&&"string"!=typeof s&&o(s)}}r.caseInsensitive&&(h=h.toLowerCase());var y,m,b,w,x,P=t.findExpressionAround(i.ast,null,s,i.scope);if(P){var A=P.node;if(!1===r.inLiteral&&"Literal"===A.type&&("string"==typeof A.value||A.regex))return{start:j(r,i,s),end:j(r,i,a),completions:[]};if("MemberExpression"==A.type&&A.object.end<s)y=P;else if(w=s,x=a,"Literal"==(b=A).type&&"string"==typeof b.value&&b.start==w-1&&b.end<=x+1){var O=t.parentNode(A,i.ast);"MemberExpression"==O.type&&O.property==A&&(y={node:O,state:P.state})}else if("ObjectExpression"==A.type){var E=C(A,a);E?(m=P,M=c=E.key.name||E.key.value):h||/:\s*$/.test(i.text.slice(0,s))||(m=P,M=c=!0)}}if(m)l=t.typeFromContext(i.ast,m),u=m.node.objType;else if(y)M="Literal"==(M=y.node.property).type?M.value.slice(1):M.name,y.node=y.node.object,l=t.expressionType(y);else if("."==p.charAt(s-1)){for(var N=s-1;N&&("."==p.charAt(N-1)||n.isIdentifierChar(p.charCodeAt(N-1)));)N--;var I=p.slice(N,s-1);I&&(l=t.def.parsePath(I,i.scope).getObjType(),M=h)}if(null!=M){if(e.cx.completingProperty=M,l&&t.forAllPropertiesOf(l,g),!d.length&&!1!==r.guess&&l&&l.guessProperties&&l.guessProperties((function(e,t,r){e!=M&&"âœ–"!=e&&"<i>"!=e&&g(e,t,r)})),!d.length&&h.length>=2&&!1!==r.guess)for(var M in e.cx.props)g(M,e.cx.props[M][0],0);f="memberCompletion"}else t.forAllLocalsAt(i.ast,s,i.scope,g),r.includeKeywords&&(e.options.ecmaVersion>=6?k:S).forEach((function(e){g(e,null,0,(function(e){e.isKeyword=!0}))})),f="variableCompletion";return e.signal(f,i,s,a,g),!1!==r.sort&&d.sort(F),e.cx.completingProperty=null,{start:j(r,i,s),end:j(r,i,a),isProperty:!!M,isObjectKey:!!c,completions:d}}},properties:{run:function(e,t){var r=t.prefix,n=[];for(var i in e.cx.props)"<i>"==i||r&&0!==i.indexOf(r)||n.push(i);return!1!==t.sort&&n.sort(F),{completions:n}}},type:{takesFile:!0,run:function(e,r,n){var i,o,s,a=M(n,r),p=L(e,r,n,a);(i=p[0])||(i=(p=L(e,r,n,a=q(n,r)))[0]),o=p[1],s=p[2];var u={guess:t.didGuess(),type:t.toString(s,r.depth),name:i&&i.name,exprName:o,doc:s.doc,url:s.url};return i&&$(r,i,u),E(u)}},documentation:{takesFile:!0,run:function(e,r,n){var i=M(n,r),o=V(e,r,n,i),s=o.getType();s||(s=(o=V(e,r,n,i=q(n,r))).getType());var a={url:o.url,doc:_(r,o.doc),type:t.toString(o)};return s&&$(r,s,a),E(a)}},definition:{takesFile:!0,run:function(e,r,n){var i=V(e,r,n,M(n,r));if(t.didGuess())return{};var o=H(i),s={url:i.url,doc:_(r,i.doc),origin:i.origin};if(i.types)for(var a=i.types.length-1;a>=0;--a){var p=i.types[a];$(r,p,s),o||(o=H(p))}if(o&&o.node){var u=o.node.sourceFile||e.fileMap[o.origin],f=j(r,u,o.node.start),l=j(r,u,o.node.end);s.start=f,s.end=l,s.file=o.origin;var c=Math.max(0,o.node.start-50);s.contextOffset=o.node.start-c,s.context=u.text.slice(c,c+50)}else o&&(s.file=o.origin,U(e,r,o,s));return E(s)}},refs:{takesFile:!0,fullFile:!0,run:function(e,t,r){var n=R(r,t,!0);if(n&&"Identifier"==n.node.type)return G(e,t,r,n);if(n&&"MemberExpression"==n.node.type&&!n.node.computed){var i=n.node.property;return n.node=n.node.object,z(e,t,r,n,i)}if(n&&"ObjectExpression"==n.node.type)for(var o=T(r,t.end),s=0;s<n.node.properties.length;++s){var a=n.node.properties[s].key;if(a.start<=o&&a.end>=o)return z(e,t,r,n,a)}else if(n&&"MethodDefinition"==n.node.type)return z(e,t,r,n,i=n.node.key);throw v("Not at a variable or property name.")}},rename:{takesFile:!0,fullFile:!0,run:function(e,t,r){if("string"!=typeof t.newName)throw v(".query.newName should be a string");var n=R(r,t);if(!n||"Identifier"!=n.node.type)throw v("Not at a variable.");var i=G(e,t,r,n,t.newName),o=i.refs;delete i.refs,i.files=e.files.map((function(e){return e.name}));for(var s=i.changes=[],a=0;a<o.length;++a){var p=o[a];p.isShorthand?p.text=n.node.name+": "+t.newName:p.text=t.newName,s.push(p)}return i}},files:{run:function(e){return{files:e.files.map((function(e){return e.name}))}}}};function p(e,t){this.name=e,this.parent=t,this.scope=this.text=this.ast=this.lineOffsets=null}function u(e,r){var n={directSourceFile:r,allowReturnOutsideFunction:!0,allowImportExportEverywhere:!0,ecmaVersion:e.options.ecmaVersion,allowHashBang:!0},i=e.signalReturnFirst("preParse",r.text,n)||r.text,o=t.parse(i,n);return e.signal("postParse",o,i),o}e.defineQueryType=function(e,t){a[e]=t},p.prototype.asLineChar=function(e){return O(this,e)};var f=/[\uD800-\uDBFF]/g;function l(e,r,n){e.text=n.options.stripCRs?r.replace(/\r\n/g,"\n"):r,e.hasAstral=f.test(e.text),t.withContext(n.cx,(function(){e.ast=u(n,e)})),e.lineOffsets=null}function c(e,r){return t.withContext(e.cx,(function(){r.scope=e.cx.topScope,e.signal("beforeLoad",r),t.analyze(r.ast,r.name,r.scope),e.signal("afterLoad",r)})),r}function h(e,r,n,i){var o=e.findFile(r);if(o)return null!=i&&(o.scope&&(e.needsPurge.push(r),t.clearScopes(o.ast),o.scope=null),l(o,i,e)),void(m(e,o.parent)>m(e,n)&&(o.parent=n,o.excluded&&(o.excluded=null)));var s=new p(r,n);e.files.push(s),e.fileMap[r]=s,null!=i?l(s,i,e):e.options.async?(e.startAsyncAction(),e.options.getFile(r,(function(t,r){l(s,r||"",e),e.finishAsyncAction(t)}))):l(s,e.options.getFile(r)||"",e)}function d(e,t,r){var n=function(){e.off("everythingFetched",n),clearTimeout(i),g(e,t,r)};e.on("everythingFetched",n);var i=setTimeout(n,e.options.fetchTimeout)}function g(e,r,n){if(e.pending)return d(e,r,n);var i=e.fetchError;if(i)return e.fetchError=null,n(i);e.needsPurge.length>0&&t.withContext(e.cx,(function(){t.purge(e.needsPurge),e.needsPurge.length=0}));for(var o=!0,s=0;s<e.files.length;){for(var a=[];s<e.files.length;++s)null==(u=e.files[s]).text?o=!1:null!=u.scope||u.excluded||a.push(u);a.sort((function(t,r){return m(e,t.parent)-m(e,r.parent)}));for(var p=0;p<a.length;p++){var u;if((u=a[p]).parent&&!b(e,u))u.excluded=!0;else if(r){var f=+new Date;try{t.withTimeout(r[0],(function(){c(e,u)}))}catch(i){if(i instanceof t.TimedOut)return n(i);throw i}r[0]-=+new Date-f}else c(e,u)}}o?n():d(e,r,n)}function y(e){for(var t=0;e;++t,e=e.prev);return t}function v(e){var t=new Error(e);return t.name="TernError",t}function m(e,t){for(var r=0;t;)t=e.fileMap[t].parent,++r;return r}function b(e,t){var r=function(e,t){for(;;){var r=e.fileMap[t.parent];if(!r.parent)break;t=r}return t.name}(e,t),n=function(e){var t=0;return i.simple(e,{Expression:function(){++t}}),t}(t.ast),o=e.budgets[r];return null==o&&(o=e.budgets[r]=e.options.dependencyBudget),!(o<n||(e.budgets[r]=o-n,0))}function w(e){return"number"==typeof e||"object"==typeof e&&"number"==typeof e.line&&"number"==typeof e.ch}(e.Server=function(e){for(var t in this.cx=null,this.options=e||{},s)e.hasOwnProperty(t)||(e[t]=s[t]);for(var r in this.projectDir=e.projectDir.replace(/\\/g,"/"),/\/$/.test(this.projectDir)||(this.projectDir+="/"),this.parent=e.parent,this.handlers=Object.create(null),this.files=[],this.fileMap=Object.create(null),this.needsPurge=[],this.budgets=Object.create(null),this.uses=0,this.pending=0,this.asyncError=null,this.mod={},this.defs=e.defs.slice(0),this.plugins=Object.create(null),e.plugins)e.plugins.hasOwnProperty(r)&&this.loadPlugin(r,e.plugins[r]);this.reset()}).prototype=r.mixin({addFile:function(e,t,r){r&&!(r in this.fileMap)&&(r=null),e in this.fileMap||(e=this.normalizeFilename(e)),h(this,e,r,t)},delFile:function(e){var t=this.findFile(e);if(t){this.needsPurge.push(t.name);for(var r=0;r<this.files.length;r++)this.files[r]==t?this.files.splice(r--,1):this.files[r].parent==e&&(this.files[r].parent=null);delete this.fileMap[t.name]}},reset:function(){this.signal("reset"),this.cx=new t.Context(this.defs,this),this.uses=0,this.budgets=Object.create(null);for(var e=0;e<this.files.length;++e){var r=this.files[e];r.scope&&(t.clearScopes(r.ast),r.scope=null)}this.signal("postReset")},request:function(e,r){var n=function(e){if(e.query){if("string"!=typeof e.query.type)return".query.type must be a string";if(e.query.start&&!w(e.query.start))return".query.start must be a position";if(e.query.end&&!w(e.query.end))return".query.end must be a position"}if(e.files){if(!Array.isArray(e.files))return"Files property must be an array";for(var t=0;t<e.files.length;++t){var r=e.files[t];if("object"!=typeof r)return".files[n] must be objects";if("string"!=typeof r.name)return".files[n].name must be a string";if("delete"!=r.type){if("string"!=typeof r.text)return".files[n].text must be a string";if("part"==r.type){if(!w(r.offset)&&"number"!=typeof r.offsetLines)return".files[n].offset must be a position"}else if("full"!=r.type)return'.files[n].type must be "full" or "part"'}}}}(e);if(n)return r(n);var o=this;!function(e,r,n){if(r.query&&!a.hasOwnProperty(r.query.type))return n("No query type '"+r.query.type+"' defined");var o=r.query;o||n(null,{});var s=r.files||[];s.length&&++e.uses;for(var p=0;p<s.length;++p){var f=s[p];f.name=e.normalizeFilename(f.name),"delete"==f.type?e.delFile(f.name):h(e,f.name,null,"full"==f.type?f.text:null)}var l="number"==typeof r.timeout?[r.timeout]:null;if(o){var c=a[o.type];if(c.takesFile){if("string"!=typeof o.file)return n(".query.file must be a string");/^#/.test(o.file)||h(e,o.file,null)}g(e,l,(function(r){if(r)return n(r);var a=c.takesFile&&function(e,r,n){var o=n.match(/^#(\d+)$/);if(!o)return e.findFile(n);var s=r[o[1]];if(!s||"delete"==s.type)throw v("Reference to unknown file "+n);if("full"==s.type)return e.fileMap[s.name];var a,p,f,l,c=s.backing=e.fileMap[s.name],h=T(c,null==s.offsetLines?s.offset:{line:s.offsetLines,ch:0},!0),d=(l=(f=s.text).indexOf("\n"))<0?f:f.slice(0,l),g=function(e,t,r){var n=Math.max(0,r-500),i=null;if(!/^\s*$/.test(e))for(;;){var o=t.indexOf(e,n);if(o<0||o>r+500)break;(null==i||Math.abs(i-r)>Math.abs(o-r))&&(i=o),n=o+e.length}return i}(d,c.text,h),m=null==g?Math.max(0,c.text.lastIndexOf("\n",h)):g;return t.withContext(e.cx,(function(){t.purge(s.name,m,m+s.text.length);var r,n=s.text;if(r=n.match(/(?:"([^"]*)"|([\w$]+))\s*:\s*function\b/)){var o=i.findNodeAround(s.backing.ast,m,"ObjectExpression");o&&o.node.objType&&(a={type:o.node.objType,prop:r[2]||r[1]})}if(g&&(r=d.match(/^(.*?)\bfunction\b/))){for(var f=r[1].length,l="",h=0;h<f;++h)l+=" ";s.text=l+n.slice(f),p=!0}var v=t.scopeAt(c.ast,m,c.scope),b=t.scopeAt(c.ast,m+n.length,c.scope),w=s.scope=y(v)<y(b)?b:v;s.ast=u(e,s),t.analyze(s.ast,s.name,w);e:if(a||p){var x=t.scopeAt(s.ast,d.length,v);if(!x.fnType)break e;if(a)a.type.getProp(a.prop).addType(x.fnType);else if(p){var P=t.scopeAt(c.ast,m+d.length,c.scope);if(P==v||!P.fnType)break e;var T=P.fnType,A=x.fnType;if(!A||A.name!=T.name&&T.name)break e;h=0;for(var O=Math.min(T.args.length,A.args.length);h<O;++h)T.args[h].propagate(A.args[h]);T.self.propagate(A.self),A.retval.propagate(T.retval)}}})),s}(e,s,o.file);if(c.fullFile&&"part"==a.type)return n("Can't run a "+o.type+" query on a file fragment");t.resetGuessing(),t.withContext(e.cx,(function(){var r,i=function(){r=c.run(e,o,a)};try{l?t.withTimeout(l[0],i):i()}catch(t){return e.options.debug&&"TernError"!=t.name&&console.error(t.stack),n(t)}n(null,r)}))}))}else g(e,l,(function(){}))}(this,e,(function(e,t){r(e,t),o.uses>40&&(o.reset(),g(o,null,(function(){})))}))},findFile:function(e){return this.fileMap[this.normalizeFilename(e)]},flush:function(e){var r=this.cx;g(this,null,(function(n){if(n)return e(n);t.withContext(r,e)}))},startAsyncAction:function(){++this.pending},finishAsyncAction:function(e){e&&(this.asyncError=e),0==--this.pending&&this.signal("everythingFetched")},addDefs:function(e,t){t?this.defs.unshift(e):this.defs.push(e),this.cx&&this.reset()},deleteDefs:function(e){for(var t=0;t<this.defs.length;t++)if(this.defs[t]["!name"]==e)return this.defs.splice(t,1),void(this.cx&&this.reset())},loadPlugin:function(e,t){if(1==arguments.length&&(t=this.options.plugins[e]||!0),!(e in this.plugins)&&e in o&&t){this.plugins[e]=!0;var r=o[e](this,t);if(r&&(r.defs&&this.addDefs(r.defs,r.loadFirst),r.passes))for(var n in r.passes)r.passes.hasOwnProperty(n)&&this.on(n,r.passes[n])}},normalizeFilename:function(e){var t=this.options.normalizeFilename(e).replace(/\\/g,"/");return 0==t.indexOf(this.projectDir)&&(t=t.slice(this.projectDir.length)),t}});var x=25;function P(e,t,r){var n,i=t+r;if(e.hasAstral)for(f.lastIndex=t;(n=f.exec(e.text))&&n.index<i;)i++;return i}var T=e.resolvePos=function(e,t,r){if("number"!=typeof t){var n=function(e,t){var r=e.text,n=e.lineOffsets||(e.lineOffsets=[0]),i=0,o=0,s=Math.min(Math.floor(t/x),n.length-1);for(i=n[s],o=s*x;o<t;){if(++o,0===(i=r.indexOf("\n",i)+1))return null;o%x==0&&n.push(i)}return i}(e,t.line);if(null==n){if(!r)throw v("File doesn't contain a line "+t.line);t=e.text.length}else t=P(e,n,t.ch)}else t=P(e,0,t);if(t>e.text.length){if(!r)throw v("Position "+t+" is outside of file.");t=e.text.length}return t};function A(e,t,r){var n,i=r-t;if(e.hasAstral)for(f.lastIndex=t;(n=f.exec(e.text))&&n.index<r;)i--;return i}function O(e,t){if(!e)return{line:0,ch:0};for(var r,n,i=e.lineOffsets||(e.lineOffsets=[0]),o=e.text,s=i.length-1;s>=0;--s)i[s]<=t&&(r=s*x,n=i[s]);for(;;){var a=o.indexOf("\n",n);if(a>=t||a<0)break;n=a+1,++r}return{line:r,ch:A(e,n,t)}}var j=e.outputPos=function(e,t,r){if(e.lineCharPositions){var n=O(t,r);return"part"==t.type&&(n.line+=null!=t.offsetLines?t.offsetLines:O(t.backing,t.offset).line),n}return A(t,0,r)+("part"==t.type?t.offset:0)};function E(e){for(var t in e)null==e[t]&&delete e[t];return e}function N(e,t,r){null!=r&&(e[t]=r)}function F(e,t){"string"!=typeof e&&(e=e.name,t=t.name);var r=/^[A-Z]/.test(e);return r==/^[A-Z]/.test(t)?e<t?-1:e==t?0:1:r?1:-1}function C(e,t){for(var r=0;r<e.properties.length;r++){var n=e.properties[r];if(n.key&&n.key.start<=t&&n.key.end>=t)return n}}var S="break do instanceof typeof case else new var catch finally return void continue for switch while debugger function this with default if throw delete in try".split(" "),k=S.concat("export class extends const super yield import let static".split(" ")),D=e.addCompletion=function(e,r,n,i,o){for(var s=e.types||e.docs||e.urls||e.origins,a=s||e.depths,p=0;p<r.length;++p){var u=r[p];if((a?u.name:u)==n)return}var f=a?{name:n}:n;if(r.push(f),i&&s){t.resetGuessing();var l=i.getType();f.guess=t.didGuess(),e.types&&(f.type=t.toString(i)),e.docs&&N(f,"doc",_(e,i.doc||l&&l.doc)),e.urls&&N(f,"url",i.url||l&&l.url),e.origins&&N(f,"origin",i.origin||l&&l.origin)}return e.depths&&(f.depth=o||0),f};function I(e,t){var r,n,i=e.body;return!!i&&(Array.isArray(i)?(r=i[0].start,n=i[i.length-1].end):(r=i.start,n=i.end),r<=t&&n>=t)}var M=e.findQueryExpr=function(e,r,n){if(null==r.end)throw v("missing .query.end field");if(r.variable){var i=t.scopeAt(e.ast,T(e,r.end),e.scope);return{node:{type:"Identifier",name:r.variable,start:r.end,end:r.end+1},state:i}}var o=r.start&&T(e,r.start),s=T(e,r.end),a=t.findExpressionAt(e.ast,o,s,e.scope);if(!a){var p=t.findClosestExpression(e.ast,o,s,e.scope);p&&!I(p.node,s)&&(n||(null==o?s:o)-p.node.start<20||p.node.end-s<20)&&(a=p)}if(!a){var u=t.findExpressionAround(e.ast,o,s,e.scope);u&&!I(u.node,s)&&("ObjectExpression"==u.node.type||n||(null==o?s:o)-u.node.start<20||u.node.end-s<20)&&(a=u)}return a};function q(e,r,n){var i=r.start&&T(e,r.start),o=T(e,r.end),s=null,a=t.findExpressionAround(e.ast,i,o,e.scope);return a&&!I(a.node,o)&&("ObjectExpression"==a.node.type||n||(null==i?o:i)-a.node.start<20||a.node.end-o<20)&&(s=a),s}function R(e,t,r){var n=M(e,t,r);if(n)return n;throw v("No expression at the given position.")}function B(e){return e&&(e=e.getType())&&e instanceof t.Obj?e:null}function V(e,r,n,i){var o;i&&(t.resetGuessing(),o=t.expressionType(i));var s,a=e.hasHandler("typeAt");if(a)for(var p=T(n,r.end),u=0;u<a.length;u++)o=a[u](n,p,i,o);if(!o)throw v("No type found at the given position.");if("ObjectExpression"==i.node.type&&null!=r.end&&(s=C(i.node,T(n,r.end)))){var f=s.key.name,l=B(t.typeFromContext(n.ast,i));if(l&&l.hasProp(f))o=l.hasProp(f);else{var c=B(o);c&&c.hasProp(f)&&(o=c.hasProp(f))}}return o}function L(e,t,r,n){var i,o=V(e,t,r,n),s=o;if(o=t.preferFunction&&o.getFunctionType()||o.getType(),n&&("Identifier"==n.node.type?i=n.node.name:"MemberExpression"!=n.node.type||n.node.computed?"MethodDefinition"!=n.node.type||n.node.computed||(i=n.node.key.name):i=n.node.property.name),null!=t.depth&&"number"!=typeof t.depth)throw v(".query.depth must be a number");return[o,i,s]}function _(e,t){if(!t)return null;if("full"==e.docFormat)return t;var r=/.\n[\s@\n]/.exec(t);if(r&&(t=t.slice(0,r.index+1)),(t=t.replace(/\n\s*/g," ")).length<100)return t;var n=/[\.!?] [A-Z]/g;n.lastIndex=80;var i=n.exec(t);return i&&(t=t.slice(0,i.index+1)),t}function $(e,r,n){n.url||(n.url=r.url),n.doc||(n.doc=_(e,r.doc)),n.origin||(n.origin=r.origin);var i,o=t.cx().protos;!n.url&&!n.doc&&r.proto&&(i=r.proto.hasCtor)&&r.proto!=o.Object&&r.proto!=o.Function&&r.proto!=o.Array&&(n.url=i.url,n.doc=_(e,i.doc))}var H=e.getSpan=function(e){if(e.origin){if(e.originNode){var t=e.originNode;return/^Function/.test(t.type)&&t.id&&(t=t.id),{origin:e.origin,node:t}}return e.span?{origin:e.origin,span:e.span}:void 0}},U=e.storeSpan=function(e,t,r,n){if(n.origin=r.origin,r.span){var i=/^(\d+)\[(\d+):(\d+)\]-(\d+)\[(\d+):(\d+)\]$/.exec(r.span);n.start=t.lineCharPositions?{line:Number(i[2]),ch:Number(i[3])}:Number(i[1]),n.end=t.lineCharPositions?{line:Number(i[5]),ch:Number(i[6])}:Number(i[4])}else{var o=e.fileMap[r.origin];n.start=j(t,o,r.node.start),n.end=j(t,o,r.node.end)}};function G(e,r,n,i,o){for(var s=i.node.name,a=i.state;a&&!(s in a.props);a=a.prev);if(!a)throw v("Could not find a definition for "+s);var p,u=[];function f(e){return function(t,n,i){var p={file:e.name,start:j(r,e,t.start),end:j(r,e,t.end)};if(o){for(var f=n;f!=a;f=f.prev){var l=f.hasProp(o);if(l)throw v("Renaming `"+s+"` to `"+o+"` would make a variable at line "+(O(e,t.start).line+1)+" point to the definition at line "+(O(e,l.name.start).line+1))}var c=i[i.length-2];c&&"Property"==c.type&&c.key==c.value&&(p.isShorthand=!0)}u.push(p)}}if(a.originNode){if(p="local",o){for(var l=a.prev;l&&!(o in l.props);l=l.prev);l&&t.findRefs(a.originNode,a,o,l,(function(e){throw v("Renaming `"+s+"` to `"+o+"` would shadow the definition used at line "+(O(n,e.start).line+1))}))}t.findRefs(a.originNode,a,s,a,f(n))}else if(p="global",r.onlySourceFile)t.findRefs(n.ast,n.scope,s,a,f(n));else for(var c=0;c<e.files.length;++c){var h=e.files[c];t.findRefs(h.ast,h.scope,s,a,f(h))}return{refs:u,type:p,name:s}}function z(e,r,n,i,o){var s=t.expressionType(i);"MethodDefinition"==i.node.type&&(s=s.propertyOf);var a=s.getObjType();if(!a)throw v("Couldn't determine type of base object.");var p=[];function u(e){return function(t){p.push({file:e.name,start:j(r,e,t.start),end:j(r,e,t.end)})}}if(r.onlySourceFile)t.findPropRefs(n.ast,n.scope,a,o.name,u(n));else for(var f=0;f<e.files.length;++f){var l=e.files[f];t.findPropRefs(l.ast,l.scope,a,o.name,u(l))}return{refs:p,name:o.name}}e.version="0.24.3"})),function(e){"object"==typeof exports&&"object"==typeof module?exports.init=e:"function"==typeof define&&define.amd?define({init:e}):tern.def={init:e}}((function(e,t){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var n=e.TypeParser=function(e,t,r,n){this.pos=t||0,this.spec=e,this.base=r,this.forceNew=n};function i(e,t,r){return e.call?e(t,r):e}function o(e,r){if("!ret"==r){if(e.retval)return e.retval;var n=new t.AVal;return e.propagate(new t.IsCallee(t.ANull,[],null,n)),n}return e.getProp(r)}function s(e){if(e instanceof t.Fn&&e.args)for(var r=0;r<e.args.length;++r){var n=e.args[r];n instanceof t.Fn&&n.args&&n.args.length&&a(e,r)}}function a(e,r){u(e,(function(n,i){i[r]&&i[r].propagate(new t.IsCallee(t.cx().topScope,e.args[r].args,null,t.ANull))}))}function p(e,r,i,o){var a=new n(e,null,i,o).parseType(!1,r,!0);return a instanceof t.AVal?a.types.forEach(s):s(a),a}function u(e,t,r){var n=e.computeRet,i=e.retval;e.computeRet=function(e,o,s){var a=t(e,o,s),p=n?n(e,o,s):i;return r?a:p}}n.prototype={eat:function(e){if(1==e.length?this.spec.charAt(this.pos)==e:this.spec.indexOf(e,this.pos)==this.pos)return this.pos+=e.length,!0},word:function(e){var t,r="";for(e=e||/[\w$]/;(t=this.spec.charAt(this.pos))&&e.test(t);)r+=t,++this.pos;return r},error:function(){throw new Error("Unrecognized type spec: "+this.spec+" (at "+this.pos+")")},parseFnType:function(e,r,n,o){var s,a,p,u,f=[],l=[],c=!1;if(!this.eat(")"))for(var h=0;;++h){var d,g=this.spec.indexOf(": ",this.pos);-1!=g&&(d=this.spec.slice(this.pos,g),/^(\.\.\.)?[$\w?]+$/.test(d)?this.pos=g+2:d=null),l.push(d);var y=this.parseType(e);if(y.call&&(c=!0),f.push(y),!this.eat(", ")){this.eat(")")||this.error();break}}if(this.eat(" -> ")){var v=this.pos;(s=this.parseType(!0)).call&&!c&&(a=s,s=t.ANull,p=v)}else s=t.ANull;return c?function(e,r,n,o){return function(s,a){for(var p=[],u=0;u<r.length;u++)p.push(i(r[u],s,a));return new t.Fn(e,t.ANull,p,i(n,s,a),o)}}(r,f,s,o):(n&&(u=this.base)?t.Fn.call(this.base,r,t.ANull,f,l,s,o):u=new t.Fn(r,t.ANull,f,l,s,o),a&&(u.computeRet=a),null!=p&&(u.computeRetSource=this.spec.slice(p,this.pos)),u)},parseType:function(e,r,n){var o=this.parseTypeMaybeProp(e,r,n);if(!this.eat("|"))return o;for(var s=[o],a=o.call;;){var p=this.parseTypeMaybeProp(e,r,n);if(s.push(p),p.call&&(a=!0),!this.eat("|"))break}if(a)return function(e){return function(r,n){for(var o=new t.AVal,s=0;s<e.length;s++)i(e[s],r,n).propagate(o);return o.maxWeight=1e5,o}}(s);for(var u=new t.AVal,f=0;f<s.length;f++)s[f].propagate(u);return u.maxWeight=1e5,u},parseTypeMaybeProp:function(e,t,r){for(var n=this.parseTypeInner(e,t,r);e&&this.eat(".");)n=this.extendWithProp(n);return n},extendWithProp:function(e){var t=this.word(/[\w<>$!:]/)||this.error();return e.apply?function(r,n){return o(e(r,n),t)}:o(e,t)},parseTypeInner:function(e,r,n){var o;if(this.eat("fn(")||(o=this.eat("fn*(")))return this.parseFnType(e,r,n,o);if(this.eat("[")){for(var s=this.parseType(e),a=s.call;this.eat(", ");){u||(u=[s]);var p=this.parseType(e);u.push(p),a=a||p.call}return this.eat("]")||this.error(),a?u?function(e){return function(r,n){return new t.Arr(e.map((function(e){return i(e,r,n)})))}}(u):function(e){return function(r,n){return new t.Arr(e(r,n))}}(s):n&&this.base?(t.Arr.call(this.base,u||s),this.base):new t.Arr(u||s)}if(this.eat("{")){var u=[],f=[];if(a=!1,!this.eat("}"))for(var l=0;;++l){var d,g=this.spec.indexOf(": ",this.pos);-1!=g&&(d=this.spec.slice(this.pos,g),/^[$\w?]+$/.test(d)?this.pos=g+2:d=null);var y=this.parseType(e);if(y.call&&(a=!0),f.push(d),u.push(y),!this.eat(", ")){this.eat("}")||this.error();break}}if(a)return function(e,r){return function(n,o){var s=new t.Obj;return e.forEach((function(e,t){s.defProp(e).addType(i(r[t],n,o))})),s}}(f,u);var v=new t.Obj;return f.forEach((function(e,t){v.defProp(e).addType(u[t])})),v}if(this.eat("+")){var b=this.word(/[\w$<>\.:!]/);if(!(w=t.cx().localDefs[b+".prototype"])){var w;if(!((w=c(b))instanceof t.Obj))return w;var x=h(w,["prototype"]);x&&(x=x.getObjType())&&(w=x)}return e&&this.eat("[")?this.parsePoly(w):n&&this.base?(this.base.proto=w,(r=w.hasCtor&&w.hasCtor.name||w.name)&&(this.base.name=r),this.base):n&&this.forceNew?new t.Obj(w):t.getInstance(w)}if(this.eat(":"))return r=this.word(/[\w$\.]/),t.getSymbol(r);if(e&&this.eat("!")){var P=this.word(/\d/);if(P)return P=Number(P),function(e,r){return r[P]||t.ANull};if(this.eat("this"))return function(e){return e};if(this.eat("custom:")){var T=this.word(/[\w$]/);return m[T]||function(){return t.ANull}}return this.fromWord("!"+this.word(/[\w$<>\.!:]/))}return this.eat("?")?t.ANull:this.fromWord(this.word(/[\w$<>\.!:`]/))},fromWord:function(e){var r=t.cx();switch(e){case"number":return r.num;case"string":return r.str;case"bool":return r.bool;case"<top>":return r.topScope}return r.localDefs&&e in r.localDefs?r.localDefs[e]:c(e)},parsePoly:function(e){var r,n="<i>";(r=this.spec.slice(this.pos).match(/^\s*([\w$:]+)\s*=\s*/))&&(n=r[1],this.pos+=r[0].length);var i=this.parseType(!0);if(this.eat("]")||this.error(),i.call)return function(r,o){var s=new t.Obj(e);return i(r,o).propagate(s.defProp(n)),s};var o=new t.Obj(e);return i.propagate(o.defProp(n)),o}};var f,l=e.parseEffect=function(e,r){var o;if(0==e.indexOf("propagate ")){var s=(d=new n(e,10)).parseType(!0);d.eat(" ")||d.error();var a=d.parseType(!0);u(r,(function(e,t){i(s,e,t).propagate(i(a,e,t))}))}else if(0==e.indexOf("call ")){var p=5==e.indexOf("and return ",5),f=(d=new n(e,p?16:5)).parseType(!0),l=null,c=[];for(d.eat(" this=")&&(l=d.parseType(!0));d.eat(" ");)c.push(d.parseType(!0));u(r,(function(e,r){for(var n=i(f,e,r),o=l?i(l,e,r):t.ANull,s=[],a=0;a<c.length;++a)s.push(i(c[a],e,r));var u=p?new t.AVal:t.ANull;return n.propagate(new t.IsCallee(o,s,null,u)),u}),p)}else if(o=e.match(/^custom (\S+)\s*(.*)/)){var h=m[o[1]];h&&u(r,o[2]?h(o[2]):h)}else{if(0!=e.indexOf("copy "))throw new Error("Unknown effect type: "+e);var d,g=(d=new n(e,5)).parseType(!0);d.eat(" ");var y=d.parseType(!0);u(r,(function(e,r){var n=i(g,e,r),o=i(y,e,r);n.forAllProps((function(e,r,n){n&&"<i>"!=e&&o.propagate(new t.DefProp(e,r))}))}))}},c=e.parsePath=function(e,r){var n=t.cx(),i=n.paths[e],o=e;if(null!=i)return i;n.paths[e]=t.ANull;var s=r||f||n.topScope;if(n.localDefs)for(var a in n.localDefs)if(0==e.indexOf(a)){if(e==a)return n.paths[e]=n.localDefs[e];if("."==e.charAt(a.length)){s=n.localDefs[a],e=e.slice(a.length+1);break}}var p=h(s,e.split("."));return n.paths[o]=p==t.ANull?null:p,p};function h(e,r){for(var n=0;n<r.length&&e!=t.ANull;++n){var i=r[n];if("!"==i.charAt(0))if("!proto"==i)e=e instanceof t.Obj&&e.proto||t.ANull;else{var o=e.getFunctionType();if(o)if("!ret"==i)e=o.retval&&o.retval.getType(!1)||t.ANull;else{var s=o.args&&o.args[Number(i.slice(1))];e=s&&s.getType(!1)||t.ANull}else e=t.ANull}else if(e instanceof t.Obj&&("prototype"==i&&e instanceof t.Fn||e.hasProp(i))){var a=e.getProp(i);e=!a||a.isEmpty()?t.ANull:a.types[0]}else e=t.ANull}return e}function d(e){var t=Object.create(e.prototype);return t.props=Object.create(null),t.isShell=!0,t}function g(e){if(!e["!type"]||/^(fn\(|\[|\+)/.test(e["!type"]))return!1;for(var t in e)if("!type"!=t&&"!doc"!=t&&"!url"!=t&&"!span"!=t&&"!data"!=t)return!1;return!0}function y(e,n,i){if(!e){var o=n["!type"];if(o)if(/^fn\(/.test(o))e=d(t.Fn);else if("["==o.charAt(0))e=d(t.Arr);else{if("+"!=o.charAt(0))throw new Error("Invalid !type spec: "+o);e=d(t.Obj)}else e=n["!stdProto"]?t.cx().protos[n["!stdProto"]]:d(t.Obj);e.name=i}for(var s in n)if(r(n,s)&&33!=s.charCodeAt(0)){var a=n[s];if("string"==typeof a||g(a))continue;var p=e.defProp(s);y(p.getObjType(),a,i?i+"."+s:s).propagate(p)}return e}function v(e,n,i){if(e.isShell){delete e.isShell;var o=n["!type"];if(o)p(o,i,e);else{var s=n["!proto"]&&p(n["!proto"]);t.Obj.call(e,!(s instanceof t.Obj)||s,i)}}var a=n["!effects"];if(a&&e instanceof t.Fn)for(var u=0;u<a.length;++u)l(a[u],e);for(var f in function(e,t){e["!doc"]&&(t.doc=e["!doc"]),e["!url"]&&(t.url=e["!url"]),e["!span"]&&(t.span=e["!span"]),e["!data"]&&(t.metaData=e["!data"])}(n,e),n)if(r(n,f)&&33!=f.charCodeAt(0)){var c=n[f],h=e.defProp(f),d=i?i+"."+f:f;if("string"==typeof c)h.isEmpty()&&p(c,d).propagate(h);else{if(g(c)){if(!h.isEmpty())continue;p(c["!type"],d,null,!0).propagate(h)}else v(h.getObjType(),c,d);c["!doc"]&&(h.doc=c["!doc"]),c["!url"]&&(h.url=c["!url"]),c["!span"]&&(h.span=c["!span"])}}return e}e.load=function(e,r){r||(r=t.cx().topScope);var n=f;f=r;try{!function(e,r){var n=t.cx(),i=n.parent;t.addOrigin(n.curOrigin=e["!name"]||"env#"+n.origins.length),n.localDefs=n.definitions[n.curOrigin]=Object.create(null),i&&i.signal("preLoadDef",e),y(r,e);var o=e["!define"];if(o){for(var s in o){var a=o[s];n.localDefs[s]="string"==typeof a?c(a):y(null,a,s)}for(var s in o)"string"!=typeof(a=o[s])&&v(n.localDefs[s],o[s],s)}v(r,e),i&&i.signal("postLoadDef",e),n.curOrigin=n.localDefs=null}(e,r)}finally{f=n}},e.parse=function(e,r,n){var i=t.cx();r&&(i.origin=r,i.localDefs=i.definitions[r]);try{return"string"==typeof e?p(e,n):v(y(null,e,n),e,n)}finally{r&&(i.origin=i.localDefs=null)}};var m=Object.create(null);t.registerFunction=function(e,t){m[e]=t};var b=t.constraint({construct:function(e,t,r){this.created=e,this.target=t,this.spec=r},addType:function(e){if(e instanceof t.Obj&&this.created++<5){var r=new t.Obj(e),n=this.spec;if(n instanceof t.AVal&&(n=n.getObjType(!1)),n instanceof t.Obj)for(var i in n.props){var o=n.props[i].types[0],s=r.defProp(i);if(o&&o instanceof t.Obj&&o.props.value){var a=o.props.value.getType(!1);a&&s.addType(a)}}this.target.addType(r)}}});t.registerFunction("Object_create",(function(e,r,n){if(n&&n.length&&"Literal"==n[0].type&&null==n[0].value)return new t.Obj;var i=new t.AVal;return r[0]&&r[0].propagate(new b(0,i,r[1])),i}));var w=t.constraint({construct:function(e){this.target=e},addType:function(e){e instanceof t.Obj&&(e.hasProp("value")?e.getProp("value").propagate(this.target):e.hasProp("get")&&e.getProp("get").propagate(new t.IsCallee(t.ANull,[],null,this.target)))}});t.registerFunction("Object_defineProperty",(function(e,r,n){if(n&&n.length>=3&&"Literal"==n[1].type&&"string"==typeof n[1].value){var i=r[0],o=new t.AVal;i.propagate(new t.DefProp(n[1].value,o,n[1])),r[2].propagate(new w(o))}return t.ANull})),t.registerFunction("Object_defineProperties",(function(e,r,n){if(r.length>=2){var i=r[0];r[1].forAllProps((function(e,r,o){if(o){var s=new t.AVal;i.propagate(new t.DefProp(e,s,n&&n[1])),r.propagate(new w(s))}}))}return t.ANull}));var x=t.constraint({construct:function(e,t,r){this.self=e,this.args=t,this.target=r},addType:function(e){if(e instanceof t.Fn){this.target.addType(new t.Fn(e.name,t.ANull,e.args.slice(this.args.length),e.argNames.slice(this.args.length),e.retval,e.generator)),this.self.propagate(e.self);for(var r=0;r<Math.min(e.args.length,this.args.length);++r)this.args[r].propagate(e.args[r])}}});function P(){var e=t.cx().definitions.ecmascript;return e&&new t.Obj(e["Promise.prototype"])}t.registerFunction("Function_bind",(function(e,r){if(!r.length)return t.ANull;var n=new t.AVal;return e.propagate(new x(r[0],r.slice(1),n)),n})),t.registerFunction("Array_ctor",(function(e,r){var n=new t.Arr;if(1!=r.length||!r[0].hasType(t.cx().num))for(var i=n.getProp("<i>"),o=0;o<r.length;++o)r[o].propagate(i);return n})),t.registerFunction("Promise_ctor",(function(e,r,n){var i=P();if(!i||r.length<1)return t.ANull;var o=i.defProp(":t",n&&n[0]),s=new t.AVal;s.propagate(o);var a=new t.Fn("execute",t.ANull,[s],["value"],t.ANull),p=t.cx().definitions.ecmascript.Promise_reject;return r[0].propagate(new t.IsCallee(t.ANull,[a,p],null,t.ANull)),i})),t.registerFunction("Promise_resolve",(function(e,r,n){var i=P();if(!i)return t.ANull;if(r.length){var o=i.defProp(":t",n&&n[0]),s=new t.AVal;s.propagate(o),r[0].propagate(new T(s))}return i}));var T=t.constraint({construct:function(e){this.output=e},addType:function(e){e.constructor==t.Obj&&"Promise"==e.name&&e.hasProp(":t")?e.getProp(":t").propagate(this.output):e.propagate(this.output)}});return t.registerFunction("Promise_then",(function(e,r,n){var i=r.length&&r[0].getFunctionType(),o=t.cx().definitions.ecmascript;if(!i||!o)return e;var s,a=new t.Obj(o["Promise.prototype"]),p=a.defProp(":t",n&&n[0]);return i.retval.isEmpty()&&(s=e.getType())instanceof t.Obj&&s.hasProp(":t")&&s.getProp(":t").propagate(p,50),i.retval.propagate(new T(p)),a})),t.registerFunction("getOwnPropertySymbols",(function(e,r){if(!r.length)return t.ANull;var n=new t.AVal;return r[0].forAllProps((function(e,r,i){i&&":"==e.charAt(0)&&n.addType(t.getSymbol(e.slice(1)))})),n})),t.registerFunction("getSymbol",(function(e,r,n){return n&&n.length&&"Literal"==n[0].type&&"string"==typeof n[0].value?t.getSymbol(n[0].value):t.ANull})),e})),function(e){"object"==typeof exports&&"object"==typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(tern.comment||(tern.comment={}))}((function(e){function t(e){return e<14&&e>8||32===e||160===e}function r(e,r){for(;r>0;--r){var n=e.charCodeAt(r-1);if(10==n)break;if(!t(n))return!1}return!0}e.commentsBefore=function(e,n){var i,o=null,s=0;e:for(;n>0;){var a=e.charCodeAt(n-1);if(10==a)for(var p=--n,u=!1;p>0;--p){if(47==(a=e.charCodeAt(p-1))&&47==e.charCodeAt(p-2)){if(!r(e,p-2))break e;var f=e.slice(p,n);!s&&i?o[0]=f+"\n"+o[0]:(o||(o=[])).unshift(f),i=!0,s=0,n=p-2;break}if(10==a){if(!u&&++s>1)break e;break}u||t(a)||(u=!0)}else if(47==a&&42==e.charCodeAt(n-2)){for(p=n-2;p>1;--p)if(42==e.charCodeAt(p-1)&&47==e.charCodeAt(p-2)){if(!r(e,p-2))break e;(o||(o=[])).unshift(e.slice(p,n-2)),i=!1,s=0;break}n=p-2}else{if(!t(a))break;--n}}return o},e.commentAfter=function(e,r){for(;r<e.length;){var n=e.charCodeAt(r);if(47==n){var i,o=e.charCodeAt(r+1);if(47==o)i=e.indexOf("\n",r+2);else{if(42!=o)return;i=e.indexOf("*/",r+2)}return e.slice(r+2,i<0?e.length:i)}t(n)&&++r}},e.ensureCommentsBefore=function(t,r){return r.hasOwnProperty("commentsBefore")?r.commentsBefore:r.commentsBefore=e.commentsBefore(t,r.start)}})),function(e,t){"object"==typeof exports&&"object"==typeof module?t(exports,require("acorn"),require("acorn-loose"),require("acorn-walk"),require("./def"),require("./signal")):"function"==typeof define&&define.amd?define(["exports","acorn/dist/acorn","acorn-loose/dist/acorn-loose","acorn-walk/dist/walk","./def","./signal"],t):t(e.tern||(e.tern={}),acorn,acorn.loose,acorn.walk,tern.def,tern.signal)}(this,(function(e,t,r,n,i,o){"use strict";var s=e.toString=function(e,t,r){return!e||e==r||t&&t<-3?"?":e.toString(t,r)},a=e.ANull=o.mixin({addType:function(){},propagate:function(){},getProp:function(){return a},forAllProps:function(){},hasType:function(){return!1},isEmpty:function(){return!0},getFunctionType:function(){},getObjType:function(){},getSymbolType:function(){},getType:function(){},gatherProperties:function(){},propagatesTo:function(){},typeHint:function(){},propHint:function(){},toString:function(){return"?"}});function p(e,t){var r=Object.create(e);if(t)for(var n in t)r[n]=t[n];return r}var u=1,f=e.AVal=function(){this.types=[],this.forward=null,this.maxWeight=0};function l(e,t,r){var n=e.getType(!1),i=t.getType(!1);return!n||!i||c(n,i,r)}function c(e,t,r){if(!e||r>=5)return t;if(!e||e==t)return e;if(!t)return e;if(e.constructor!=t.constructor)return!1;if(e.constructor!=R){if(e.constructor==D){var n=0,i=0,o=0;for(var s in e.props)n++,s in t.props&&l(e.props[s],t.props[s],r+1)&&o++;for(var s in t.props)i++;return!(n&&i&&o<Math.max(n,i)/2)&&(n>i?e:t)}return e.constructor==q&&!!(e.args.length==t.args.length&&e.args.every((function(e,n){return l(e,t.args[n],r+1)}))&&l(e.retval,t.retval,r+1)&&l(e.self,t.self,r+1))&&e}var a=e.getProp("<i>").getType(!1);if(!a)return t;var p=t.getProp("<i>").getType(!1);return!p||c(a,p,r+1)?t:void 0}f.prototype=p(a,{addType:function(e,t){if(t=t||100,this.maxWeight<t){if(this.maxWeight=t,1==this.types.length&&this.types[0]==e)return;this.types.length=0}else if(this.maxWeight>t||this.types.indexOf(e)>-1)return;this.signal("addType",e),this.types.push(e);var r=this.forward;r&&U((function(n){for(var i=0;i<r.length;++i)n(e,r[i],t)}))},propagate:function(e,t){if(!(e==a||e instanceof C&&this.forward&&this.forward.length>2)){t&&100!=t&&(e=new F(e,t)),(this.forward||(this.forward=[])).push(e);var r=this.types;r.length&&U((function(n){for(var i=0;i<r.length;++i)n(r[i],e,t)}))}},getProp:function(e){if(M(e))return a;var t=(this.props||(this.props=Object.create(null)))[e];return t||(t=this.props[e]=new f,this.propagate(new y(e,t))),t},forAllProps:function(e){this.propagate(new m(e))},hasType:function(e){return this.types.indexOf(e)>-1},isEmpty:function(){return 0===this.types.length},getFunctionType:function(){for(var e=this.types.length-1;e>=0;--e)if(this.types[e]instanceof q)return this.types[e]},getObjType:function(){for(var e=null,t=this.types.length-1;t>=0;--t){var r=this.types[t];if(r instanceof D){if(r.name)return r;e||(e=r)}}return e},getSymbolType:function(){for(var e=this.types.length-1;e>=0;--e)if(this.types[e]instanceof B)return this.types[e]},getType:function(e){return 0===this.types.length&&!1!==e?this.makeupType():1===this.types.length?this.types[0]:d(this.types)},toString:function(e,t){if(0==this.types.length)return s(this.makeupType(),e,t);if(1==this.types.length)return s(this.types[0],e,t);var r=h(this.types);return r.length>2?"?":r.map((function(r){return s(r,e,t)})).join("|")},makeupPropType:function(e){var t=this.propertyName,r=e.proto&&e.proto.hasProp(t);if(r){var n=r.getType();if(n)return n}if("<i>"!=t){var i=e.hasProp("<i>");if(i)return i.getType()}else if(e.props["<i>"]!=this)for(var o in e.props){var s=e.props[o];if(!s.isEmpty())return s.getType()}},makeupType:function(){var e=this.propertyOf&&this.makeupPropType(this.propertyOf);if(e)return e;if(!this.forward)return null;for(var t=this.forward.length-1;t>=0;--t){var r=this.forward[t].typeHint();if(r&&!r.isEmpty())return De=!0,r}var n=Object.create(null),i=null;for(t=0;t<this.forward.length;++t)(p=this.forward[t].propHint())&&"length"!=p&&"<i>"!=p&&"âœ–"!=p&&p!=_.completingProperty&&(n[p]=!0,i=p);if(!i)return null;var o=V(i);if(o){var s=[];e:for(t=0;t<o.length;++t){var a=o[t];for(var p in n)if(!a.hasProp(p))continue e;a.hasCtor&&(a=P(a)),s.push(a)}var u=d(s);if(u)return De=!0,u}},typeHint:function(){return this.types.length?this.getType():null},propagatesTo:function(){return this},gatherProperties:function(e,t){for(var r=0;r<this.types.length;++r)this.types[r].gatherProperties(e,t)},guessProperties:function(e){if(this.forward)for(var t=0;t<this.forward.length;++t){var r=this.forward[t].propHint();r&&e(r,null,0)}var n=this.makeupType();n&&n.gatherProperties(e)}});var h=e.simplifyTypes=function(e){var t=[];e:for(var r=0;r<e.length;++r){for(var n=e[r],i=0;i<t.length;i++){var o=c(n,t[i],0);if(o){t[i]=o;continue e}}t.push(n)}return t};function d(e){for(var t=0,r=0,n=0,i=null,o=0;o<e.length;++o)if((p=e[o])instanceof R)++t;else if(p instanceof q)++r;else if(p instanceof D)++n;else if(p instanceof S){if(i&&p.name!=i.name)return null;i=p}if((t&&1)+(r&&1)+(n&&1)+(i&&1)>1)return null;if(i)return i;var s=0,a=null;for(o=0;o<e.length;++o){var p=e[o],u=0;if(t)u=p.getProp("<i>").isEmpty()?1:2;else if(r){u=1;for(var f=0;f<p.args.length;++f)p.args[f].isEmpty()||++u;p.retval.isEmpty()||++u}else n&&(u=p.name?100:2);u>=s&&(s=u,a=p)}return a}var g=e.constraint=function(e){var t=function(){this.origin=_.curOrigin,this.construct.apply(this,arguments)};for(var r in t.prototype=Object.create(a),e)e.hasOwnProperty(r)&&(t.prototype[r]=e[r]);return t},y=g({construct:function(e,t){this.prop=e,this.target=t},addType:function(e,t){e.getProp&&e.getProp(this.prop).propagate(this.target,t)},propHint:function(){return this.prop},propagatesTo:function(){if("<i>"==this.prop||!/[^\w_]/.test(this.prop))return{target:this.target,pathExt:"."+this.prop}}}),v=e.PropHasSubset=e.DefProp=g({construct:function(e,t,r){this.prop=e,this.type=t,this.originNode=r},addType:function(e,t){if(e instanceof D){var r=e.defProp(this.prop,this.originNode);r.origin||(r.origin=this.origin),this.type.propagate(r,t)}},propHint:function(){return this.prop}}),m=g({construct:function(e){this.c=e},addType:function(e){e instanceof D&&e.forAllProps(this.c)}}),b=e.IsCallee=g({construct:function(e,t,r,n){this.self=e,this.args=t,this.argNodes=r,this.retval=n,this.disabled=_.disabledComputing},addType:function(e,t){if(e instanceof q){for(var r=0;r<this.args.length;++r)r<e.args.length&&this.args[r].propagate(e.args[r],t),e.arguments&&this.args[r].propagate(e.arguments,t);e.isArrowFn()||this.self.propagate(e.self,this.self==_.topScope?90:t);var n=e.computeRet,i=e.retval;if(n)for(var o=this.disabled;o;o=o.prev)(o.fn==e||e.originNode&&o.fn.originNode==e.originNode)&&(n=null);if(n){var s=_.disabledComputing;_.disabledComputing=this.disabled,i=n(this.self,this.args,this.argNodes),_.disabledComputing=s}if(e.async&&!e.generator){var a=i.getType();if(!a||a.constructor!=D||"Promise"!=a.name){var p=_.definitions.ecmascript,u=p&&new D(p["Promise.prototype"]);u&&(u.getType().propagate(new v(":t",i)),i=u)}}je(e,i).propagate(this.retval,t)}},typeHint:function(){for(var e=[],t=0;t<this.args.length;++t)e.push("?");return new q(null,this.self,this.args,e,a)},propagatesTo:function(){return{target:this.retval,pathExt:".!ret"}}}),w=g({construct:function(e,t,r,n){this.propName=e,this.args=t,this.argNodes=r,this.retval=n,this.disabled=_.disabledComputing},addType:function(e,t){var r=new b(e,this.args,this.argNodes,this.retval);r.disabled=this.disabled,e.getProp(this.propName).propagate(r,t)},propHint:function(){return this.propName}}),x=e.IsCtor=g({construct:function(e,t){this.target=e,this.noReuse=t},addType:function(e,t){e instanceof q&&(_.parent&&!_.parent.options.reuseInstances&&(this.noReuse=!0),e.getProp("prototype").propagate(new T(!this.noReuse&&e,this.target),t))}}),P=e.getInstance=function(e,t){if(!1===t)return new D(e);t||(t=e.hasCtor),e.instances||(e.instances=[]);for(var r=0;r<e.instances.length;++r){var n=e.instances[r];if(n.ctor==t)return n.instance}var i=new D(e,t&&t.name);return i.origin=e.origin,e.instances.push({ctor:t,instance:i}),i},T=e.IsProto=g({construct:function(e,t){this.ctor=e,this.target=t},addType:function(e,t){e instanceof D&&((this.count=(this.count||0)+1)>8||(e==_.protos.Array?this.target.addType(new R):this.target.addType(P(e,this.ctor))))}}),A=g({construct:function(e){this.fn=e},addType:function(e,t){if(e instanceof D&&!e.hasCtor){e.hasCtor=this.fn;var r=new E(e,this.fn);r.addType(this.fn),e.forAllProps((function(e,t,n){n&&t.propagate(r)}))}}}),O=g({construct:function(e,t){this.other=e,this.target=t},addType:function(e,t){e==_.str?this.target.addType(_.str,t):e==_.num&&this.other.hasType(_.num)&&this.target.addType(_.num,t)},typeHint:function(){return this.other}}),j=e.IfObj=g({construct:function(e){this.target=e},addType:function(e,t){e instanceof D&&this.target.addType(e,t)},propagatesTo:function(){return this.target}}),E=g({construct:function(e,t){this.obj=e,this.ctor=t},addType:function(e){e instanceof q&&e.self&&e.self.addType(P(this.obj,this.ctor),4)}}),N=g({construct:function(e){this.obj=e},addType:function(e){e instanceof D&&this.obj.proto==_.protos.Object&&this.obj.replaceProto(e)}}),F=g({construct:function(e,t){this.inner=e,this.weight=t},addType:function(e,t){this.inner.addType(e,Math.min(t,this.weight))},propagatesTo:function(){return this.inner.propagatesTo()},typeHint:function(){return this.inner.typeHint()},propHint:function(){return this.inner.propHint()}}),C=e.Type=function(){};C.prototype=p(a,{constructor:C,propagate:function(e,t){e.addType(this,t)},hasType:function(e){return e==this},isEmpty:function(){return!1},typeHint:function(){return this},getType:function(){return this}});var S=e.Prim=function(e,t){this.name=t,this.proto=e};function k(e){var t=e.charCodeAt(0);return t>=48&&t<=57&&!/\D/.test(e)}S.prototype=p(C.prototype,{constructor:S,toString:function(){return this.name},getProp:function(e){return this.proto.hasProp(e)||a},gatherProperties:function(e,t){this.proto&&this.proto.gatherProperties(e,t)}});var D=e.Obj=function(e,t){if(this.props||(this.props=Object.create(null)),this.proto=!0===e?_.protos.Object:e,e&&e!=_.protos.Object&&!t&&e.name&&!(this instanceof q)){var r=/^(.*)\.prototype$/.exec(this.proto.name);r&&(t=r[1])}this.name=t,this.maybeProps=null,this.origin=_.curOrigin};D.prototype=p(C.prototype,{constructor:D,toString:function(e){if(null==e&&(e=0),e<=0&&this.name)return this.name;var t=[],r=!1;for(var n in this.props)if("<i>"!=n){if(t.length>5){r=!0;break}e?t.push(n+": "+s(this.props[n],e-1,this)):t.push(n)}return t.sort(),r&&t.push("..."),"{"+t.join(", ")+"}"},hasProp:function(e,t){k(e)&&(e=this.normalizeIntegerProp(e));var r=this.props[e];if(!1!==t)for(var n=this.proto;n&&!r;n=n.proto)r=n.props[e];return r},defProp:function(e,t){var r=this.hasProp(e,!1);if(r)return t&&!r.originNode&&(r.originNode=t),r;if(M(e))return a;k(e)&&(e=this.normalizeIntegerProp(e));var n=this.maybeProps&&this.maybeProps[e];return n?(delete this.maybeProps[e],this.maybeUnregProtoPropHandler()):((n=new f).propertyOf=this,n.propertyName=e),this.props[e]=n,n.originNode=t,n.origin=_.curOrigin,this.broadcastProp(e,n,!0),n},getProp:function(e){var t=this.hasProp(e,!0)||this.maybeProps&&this.maybeProps[e];if(t)return t;if(M(e))return a;k(e)&&(e=this.normalizeIntegerProp(e));var r=this.ensureMaybeProps()[e]=new f;return r.propertyOf=this,r.propertyName=e,r},normalizeIntegerProp:function(e){return"<i>"},broadcastProp:function(e,t,r){if(r&&(this.signal("addProp",e,t),this instanceof z||function(e,t){(_.props[e]||(_.props[e]=[])).push(t)}(e,this)),this.onNewProp)for(var n=0;n<this.onNewProp.length;++n){var i=this.onNewProp[n];i.onProtoProp?i.onProtoProp(e,t,r):i(e,t,r)}},onProtoProp:function(e,t,r){var n=this.maybeProps&&this.maybeProps[e];n&&(delete this.maybeProps[e],this.maybeUnregProtoPropHandler(),this.proto.getProp(e).propagate(n)),this.broadcastProp(e,t,!1)},replaceProto:function(e){for(var t=e;t;t=t.proto)if(t==this)return;this.proto&&this.maybeProps&&this.proto.unregPropHandler(this),this.proto=e,this.maybeProps&&this.proto.forAllProps(this)},ensureMaybeProps:function(){return this.maybeProps||(this.proto&&this.proto.forAllProps(this),this.maybeProps=Object.create(null)),this.maybeProps},removeProp:function(e){var t=this.props[e];delete this.props[e],this.ensureMaybeProps()[e]=t,t.types.length=0},forAllProps:function(e){this.onNewProp||(this.onNewProp=[],this.proto&&this.proto.forAllProps(this)),this.onNewProp.push(e);for(var t=this;t;t=t.proto)for(var r in t.props)e.onProtoProp?e.onProtoProp(r,t.props[r],t==this):e(r,t.props[r],t==this)},maybeUnregProtoPropHandler:function(){if(this.maybeProps){for(var e in this.maybeProps)return;this.maybeProps=null}!this.proto||this.onNewProp&&this.onNewProp.length||this.proto.unregPropHandler(this)},unregPropHandler:function(e){for(var t=0;t<this.onNewProp.length;++t)if(this.onNewProp[t]==e){this.onNewProp.splice(t,1);break}this.maybeUnregProtoPropHandler()},gatherProperties:function(e,t){for(var r in this.props)"<i>"!=r&&":"!=r.charAt(0)&&e(r,this,t);this.proto&&this.proto.gatherProperties(e,t+1)},getObjType:function(){return this}});var I="undefined"!=typeof StopIteration;function M(e){return"__proto__"==e||"âœ–"==e||I&&"__iterator__"==e}var q=e.Fn=function(e,t,r,n,i,o,s){D.call(this,_.protos.Function,e),this.self=t,this.args=r,this.argNames=n,this.retval=i,this.generator=o,this.async=s};q.prototype=p(D.prototype,{constructor:q,toString:function(e){null==e&&(e=0);for(var t=this.generator?"fn*(":"fn(",r=0;r<this.args.length;++r){r&&(t+=", ");var n=this.argNames[r];n&&"?"!=n&&(t+=n+": "),t+=e>-3?s(this.args[r],e-1,this):"?"}return t+=")",this.retval.isEmpty()||(t+=" -> "+(e>-3?s(this.retval,e-1,this):"?")),t},getProp:function(e){if("prototype"==e){var t=this.hasProp(e,!1);if(!t){t=this.defProp(e);var r=new D(!0,this.name&&this.name+".prototype");r.origin=this.origin,t.addType(r,10)}return t}return D.prototype.getProp.call(this,e)},defProp:function(e,t){if("prototype"==e){var r=this.hasProp(e,!1);return r||((r=D.prototype.defProp.call(this,e,t)).origin=this.origin,r.propagate(new A(this)),r)}return D.prototype.defProp.call(this,e,t)},getFunctionType:function(){return this},isArrowFn:function(){return this.originNode&&"ArrowFunctionExpression"==this.originNode.type}});var R=e.Arr=function(e){D.call(this,_.protos.Array);var t=this.defProp("<i>");if(Array.isArray(e)){this.tuple=e.length;for(var r=0;r<e.length;r++){var n=this.defProp(String(r));e[r].propagate(n),n.propagate(t)}}else e&&(this.tuple=0,e.propagate(t))};R.prototype=p(D.prototype,{constructor:R,toString:function(e){if(null==e&&(e=0),e<=-3)return"[?]";var t="";if(this.tuple){for(var r,n=0;n in this.props;n++){var i=s(this.getProp(String(n)),e-1,this);r=(null==r||r==i)&&i,t+=(t?", ":"")+i}r&&(t=r)}else t=s(this.getProp("<i>"),e-1,this);return"["+t+"]"},normalizeIntegerProp:function(e){return+e<this.tuple?e:"<i>"}});var B=e.Sym=function(e,t){S.call(this,_.protos.Symbol,"Symbol"),this.symName=e,this.originNode=t};function V(e){return _.props[e]}B.prototype=p(S.prototype,{constructor:B,asPropName:function(){return":"+this.symName},getSymbolType:function(){return this}}),e.getSymbol=function(e,t){var r=e.replace(/[^\w$\.]/g,"_"),n=_.symbols[r];return n?(t&&!n.originNode&&(n.originNode=t),n):_.symbols[r]=new B(r,t)},e.Context=function(t,r){this.parent=r,this.props=Object.create(null),this.protos=Object.create(null),this.origins=[],this.curOrigin="ecmascript",this.paths=Object.create(null),this.definitions=Object.create(null),this.purgeGen=0,this.workList=null,this.disabledComputing=null,this.curSuperCtor=this.curSuper=null,this.symbols=Object.create(null),e.withContext(this,(function(){if(_.protos.Object=new D(null,"Object.prototype"),_.topScope=new z,_.topScope.name="<top>",_.protos.Array=new D(!0,"Array.prototype"),_.protos.Function=new q("Function.prototype",a,[],[],a),_.protos.Function.proto=_.protos.Object,_.protos.RegExp=new D(!0,"RegExp.prototype"),_.protos.String=new D(!0,"String.prototype"),_.protos.Number=new D(!0,"Number.prototype"),_.protos.Boolean=new D(!0,"Boolean.prototype"),_.protos.Symbol=new D(!0,"Symbol.prototype"),_.str=new S(_.protos.String,"string"),_.bool=new S(_.protos.Boolean,"bool"),_.num=new S(_.protos.Number,"number"),_.curOrigin=null,t)for(var e=0;e<t.length;++e)i.load(t[e])}))},e.Context.prototype.startAnalysis=function(){this.disabledComputing=this.workList=this.curSuperCtor=this.curSuper=null};var L,_=null;e.cx=function(){return _},e.withContext=function(e,t){var r=_;_=e;try{return t()}finally{_=r}},e.TimedOut=function(){this.message="Timed out",this.stack=(new Error).stack},e.TimedOut.prototype=Object.create(Error.prototype),e.TimedOut.prototype.name="infer.TimedOut",e.withTimeout=function(e,t){var r=+new Date+e,n=L;if(n&&n<r)return t();L=r;try{return t()}finally{L=n}},e.addOrigin=function(e){_.origins.indexOf(e)<0&&_.origins.push(e)};var $=20,H=1e-4;function U(t){if(_.workList)return t(_.workList);for(var r=[],n=0,i=t(_.workList=function(e,t,i){n<$-H*r.length&&r.push(e,t,i,n)}),o=0;o<r.length;o+=4){if(L&&+new Date>=L)throw new e.TimedOut;n=r[o+3]+1,r[o+1].addType(r[o],r[o+2])}return _.workList=null,i}function G(e,t,r){var n=_.curSuperCtor,i=_.curSuper;_.curSuperCtor=e,_.curSuper=t;var o=r();return _.curSuperCtor=n,_.curSuper=i,o}var z=e.Scope=function(e,t,r,n){D.call(this,e||!0),this.prev=e,this.originNode=t,this.isBlock=!!r,this.isCatch=!!n};function W(e,t){for(;e.isBlock||e.isCatch||!1===t&&e.fnType&&e.fnType.isArrowFn();)e=e.prev;return e}function Z(e,t){var r=W(e).fnType;r&&(r.instantiateScore=(r.instantiateScore||0)+t)}z.prototype=p(D.prototype,{constructor:z,defVar:function(e,t){for(var r=this;;r=r.proto){var n=r.props[e];if(n)return n;if(!r.prev)return r.defProp(e,t)}}});var K={};function Q(e,t){var r=t.instantiateScore;if(!_.disabledComputing&&r&&t.args.length&&function(e,t){try{return n.simple(e,{Expression:function(){if(--t<=0)throw K}}),!0}catch(e){if(e==K)return!1;throw e}}(e,5*r))return Z(W(t.originNode.scope.prev),r/2),function(e,t){for(var r=e.scope,i=0;i<t.args.length;++i)t.args[i]=new f;t.self=new f,t.computeRet=function(i,o){return function(e,t){_.disabledComputing={fn:e,prev:_.disabledComputing};var r=t();return _.disabledComputing=_.disabledComputing.prev,r}(t,(function(){var s=_.curOrigin;_.curOrigin=t.origin;var p=e.scope?e.scope:r,u=new z(p.prev,p.originNode);for(var l in p.props)for(var c=u.defProp(l,p.props[l].originNode),h=0;h<o.length;++h)t.argNames[h]==l&&h<o.length&&o[h].propagate(c);for(var d=t.argNames.length!=o.length?t.argNames.slice(0,o.length):t.argNames;d.length<o.length;)d.push("?");if(u.fnType=new q(t.name,i,o,d,a,t.generator,t.async),u.fnType.originNode=t.originNode,t.arguments){var g=u.fnType.arguments=new f;for(u.defProp("arguments").addType(new R(g)),h=0;h<o.length;++h)o[h].propagate(g)}return e.scope=u,n.recursive(e.body,u,null,re),n.recursive(e.body,u,null,Te),_.curOrigin=s,u.fnType.retval}))}}(e,t),!0;t.instantiateScore=null}function Y(e){var t=e.retval;if(t!=a&&!e.isArrowFn()){var r,n;!t.isEmpty()&&(r=t.getType())instanceof R&&(t=n=r.getProp("<i>"));for(var o=u(e.self,"!this",0),s=0;!o&&s<e.args.length;++s)o=u(e.args[s],"!"+s,0);if(o){n&&(o="["+o+"]");var p=new i.TypeParser(o).parseType(!0);return e.computeRet=p.apply?p:function(){return p},e.computeRetSource=o,!0}}function u(e,r,n){if(!(n>3)&&e.forward)for(var i=0;i<e.forward.length;++i){var o=e.forward[i].propagatesTo();if(o){var s,a=r;if(o instanceof f)s=o;else{if(!(o.target instanceof f))continue;a+=o.pathExt,s=o.target}if(s==t)return a;var p=u(s,a,n+1);if(p)return p}}}}function J(e,t){return e.defProp(t.name,t)}function X(e){return"Identifier"==e.type?e.name:"AssignmentPattern"==e.type?X(e.left):"ObjectPattern"==e.type?"{"+e.properties.map((function(e){return X("RestElement"===e.type?e:e.value)})).join(", ")+"}":"ArrayPattern"==e.type?"["+e.elements.map((function(e){return e?X(e):""})).join(", ")+"]":"RestElement"==e.type?"..."+X(e.argument):"_"}function ee(e){return"VariableDeclaration"==e.type&&"var"!=e.kind||"FunctionDeclaration"==e.type||"ClassDeclaration"==e.type}function te(e,t){return{inner:e,outer:t||e}}var re=e.scopeGatherer=n.make({VariablePattern:function(e,t){t.inner&&J(t.inner,e)},AssignmentPattern:function(e,t,r){r(e.left,t,"Pattern"),r(e.right,t.outer,"Expression")},AssignmentExpression:function(e,t,r){"MemberExpression"==e.left.type?r(e.left,t,"Expression"):r(e.left,te(!1,t),"Pattern"),r(e.right,t,"Expression")},MemberPattern:function(e,t,r){r(e,t.outer)},Function:function(e,t,r){for(var n=e.scope=new z(t,e),i=[],o=[],s=0;s<e.params.length;++s){var p=e.params[s];if(o.push(X(p)),"Identifier"==p.type)i.push(J(n,p));else{var u=new f;i.push(u),u.originNode=p,r(p,te(n),"Pattern")}}n.fnType=new q(e.id&&e.id.name,new f,i,o,a,e.generator,e.async),n.fnType.originNode=e,e.id&&J("FunctionDeclaration"==e.type?t:n,e.id),r(e.body,n,e.expression?"Expression":"Statement")},BlockStatement:function(e,t,r){!e.scope&&e.body.some(ee)&&(t=e.scope=new z(t,e,!0)),n.base.BlockStatement(e,t,r)},CatchClause:function(e,t,r){if(e.param)if(t=e.scope=new z(t,e,!1,!0),"Identifier"==e.param.type){var n=J(t,e.param);r(e.body,t,"Statement");var i=_.definitions.ecmascript;i&&n.isEmpty()&&P(i["Error.prototype"]).propagate(n,6)}else r(e.param,te(t),"Pattern")},VariableDeclaration:function(e,t,r){for(var n="var"==e.kind?W(t):t,i=0;i<e.declarations.length;++i){var o=e.declarations[i];r(o.id,te(n,t),"Pattern"),o.init&&r(o.init,t,"Expression")}},ClassDeclaration:function(e,t,r){e.id&&J(t,e.id),e.superClass&&r(e.superClass,t,"Expression");for(var n=0;n<e.body.body.length;n++)r(e.body.body[n],t)},ForInStatement:function(e,t,r){!e.scope&&ee(e.left)&&(t=e.scope=new z(t,e,!0)),n.base.ForInStatement(e,t,r)},ForStatement:function(e,t,r){!e.scope&&e.init&&ee(e.init)&&(t=e.scope=new z(t,e,!0)),n.base.ForStatement(e,t,r)},ImportDeclaration:function(e,t){for(var r=0;r<e.specifiers.length;r++)J(t,e.specifiers[r].local)}});function ne(e){e.scope&&(e.scope=null)}re.ForOfStatement=re.ForInStatement;var ie={BlockStatement:ne,Function:ne,CatchClause:ne,ForInStateMent:ne,ForStatement:ne};e.clearScopes=function(e){n.simple(e,ie)};var oe=e.propName=function(e,t){var r=e.property||e.key;if(!e.computed&&"Identifier"==r.type)return r.name;if("Literal"==r.type){if("string"==typeof r.value)return r.value;if("number"==typeof r.value)return String(r.value)}if(t){var n=se(xe(r,t));if(n)return e.propName=n}else if(e.propName)return e.propName;return"<i>"};function se(e){var t=e.getSymbolType();if(t)return t.asPropName()}function ae(e){switch(e){case"+":case"-":case"~":return _.num;case"!":return _.bool;case"typeof":return _.str;case"void":case"delete":return a}}function pe(e){switch(e){case"==":case"!=":case"===":case"!==":case"<":case">":case">=":case"<=":case"in":case"instanceof":return!0}}function ue(e){if(e.regex)return P(_.protos.RegExp);switch(typeof e.value){case"boolean":return _.bool;case"number":return _.num;case"string":return _.str;case"object":case"function":return e.value?P(_.protos.RegExp):a}}function fe(e,t){for(var r=0;r<e.params.length;r++){var n=e.params[r];"Identifier"!=n.type&&he(n,t,e.scope.fnType.args[r])}}function le(e,t){return t.hasProp(e.name)||_.topScope.defProp(e.name,e)}var ce=e.inferPatternVisitor={Identifier:function(e,t,r){r.propagate(le(e,t))},MemberExpression:function(e,t,r){var n=xe(e.object,t),i=oe(e,t);n.propagate(new v(i,r,e.property))},RestElement:function(e,t,r){he(e.argument,t,new R(r))},ObjectPattern:function(e,t,r){for(var n=0;n<e.properties.length;++n){var i=e.properties[n];"RestElement"!=i.type&&he(i.value,t,r.getProp(oe(i)))}},ArrayPattern:function(e,t,r){for(var n=0;n<e.elements.length;n++)e.elements[n]&&he(e.elements[n],t,r.getProp(String(n)))},AssignmentPattern:function(e,t,r){he(e.left,t,function(e,t){if(e==t||t==a)return e;if(e==a)return t;var r=new f;return e.propagate(r),t.propagate(r),r}(r,xe(e.right,t)))}};function he(e,t,r){var n=ce[e.type];n&&n(e,t,r)}function de(e){var t=W(e);return t.fnType?t.fnType.self:t}function ge(e){e.isEmpty()&&e.propertyOf&&(e.propertyOf.getProp(e.propertyName).addType(new D,u),ge(e.propertyOf))}function ye(e,t,r){!r&&e.id&&(r=e.id.name);var n,i,o=_.protos.Object;if(e.superClass)if("Literal"==e.superClass.type&&null==e.superClass.value)o=null;else{var s,p=xe(e.superClass,t);(n=p.getFunctionType())&&(s=n.getProp("prototype").getObjType())?o=s:(n=p,i=p.getProp("prototype"))}var u=new D(o,r&&r+".prototype");return i&&i.propagate(new N(u)),G(n,i||o,(function(){for(var n,i=e.body.body,o=0;o<i.length;o++)"constructor"==i[o].kind&&(n=i[o].value);var s=e.objType=n?xe(n,t):new q(r,a,[],null,a);s.originNode=e.id||n||e;var p=P(u,s);for(s.self.addType(p),s.defProp("prototype",e).addType(u),o=0;o<i.length;o++){var f,l=i[o];if("constructor"!=l.kind){var c=oe(l,t);"<i>"==c||"set"==l.kind?f=a:((f=(l.static?s:u).defProp(c,l.key)).initializer=!0,"get"==l.kind&&(f=new b(p,[],null,f))),xe(l.value,t,f);var h=f.getFunctionType();h&&h.self.addType(p)}}return s}))}function ve(e,t,r){var n=e.length>1&&e.length<6;if(n){for(var i,o=!0,s=0;s<e.length;s++){var a=e[s];a?"Literal"!=a.type||i&&i!=typeof a.value?o=!1:i=typeof a.value:n=!1}o&&(n=!1)}if(n){var p=[];for(s=0;s<e.length;++s)p.push(r(e[s],t));return new R(p)}if(e.length<2)return new R(e[0]&&r(e[0],t));var u=new f;for(s=0;s<e.length;s++)e[s]&&r(e[s],t).propagate(u);return new R(u)}function me(e){return function(t,r,n,i){var o=e(t,r,i);return n&&o.propagate(n),o}}function be(e){return function(t,r,n,i){return n||(n=new f),e(t,r,n,i),n}}var we=e.inferExprVisitor={ArrayExpression:me((function(e,t){return ve(e.elements,t,xe)})),ObjectExpression:me((function(e,t,r){for(var n,i=_.protos.Object,o=0;o<e.properties.length;++o){var s=e.properties[o];if("SpreadElement"!=s.type&&"__proto__"==s.key.name)if("Literal"==s.value.type&&null==s.value.value)i=null;else{var p=xe(s.value,t),u=p.getObjType();u?i=u:n=p}}var f=e.objType=new D(i,r);return n&&n.propagate(new N(f)),f.originNode=e,G(null,n||i,(function(){for(var r=0;r<e.properties.length;++r){var n=e.properties[r],i=n.key;if("SpreadElement"!=n.type&&!M(n.key.name)){var o,s=oe(n,t);if("<i>"==s||"set"==n.kind)o=a;else{var p=o=f.defProp(s,i);p.initializer=!0,"get"==n.kind&&(o=new b(f,[],null,p))}xe(n.value,t,o,s),"FunctionExpression"==n.value.type&&n.value.scope.fnType.self.addType(f,2)}}})),f})),FunctionExpression:me((function(e,t,r){var i=e.scope,o=i.fnType;return r&&!o.name&&(o.name=r),fe(e,i),e.expression?xe(e.body,i,i.fnType.retval=new f):n.recursive(e.body,i,null,Te,"Statement"),"ArrowFunctionExpression"==e.type&&de(t).propagate(o.self),Q(e,o)||Y(o),e.id&&i.getProp(e.id.name).addType(o),o})),ClassExpression:me(ye),SequenceExpression:me((function(e,t){for(var r=0,n=e.expressions.length-1;r<n;++r)xe(e.expressions[r],t,a);return xe(e.expressions[n],t)})),UnaryExpression:me((function(e,t){return xe(e.argument,t,a),ae(e.operator)})),UpdateExpression:me((function(e,t){return xe(e.argument,t,a),_.num})),BinaryExpression:me((function(e,t){if("+"==e.operator){var r=xe(e.left,t),n=xe(e.right,t);if(r.hasType(_.str)||n.hasType(_.str))return _.str;if(r.hasType(_.num)&&n.hasType(_.num))return _.num;var i=new f;return r.propagate(new O(n,i)),n.propagate(new O(r,i)),i}return xe(e.left,t,a),xe(e.right,t,a),pe(e.operator)?_.bool:_.num})),AssignmentExpression:me((function(e,t,r){var n,i;if("MemberExpression"==e.left.type?(i=oe(e.left,t),r||(r="Identifier"==e.left.object.type?e.left.object.name+"."+i:i)):r||"Identifier"!=e.left.type||(r=e.left.name),e.operator&&"="!=e.operator&&"+="!=e.operator?(xe(e.right,t,a),n=_.num):n=xe(e.right,t,null,r),"MemberExpression"==e.left.type){var o=xe(e.left.object,t);if("prototype"==i&&Z(t,20),"<i>"==i){var s=e.left.property.name,p=t.props[s],u=p&&p.iteratesOver;if(u){Z(t,20);var f="MemberExpression"==e.right.type&&e.right.computed&&e.right.property.name==s;return u.forAllProps((function(e,t,r){r&&"prototype"!=e&&"<i>"!=e&&o.propagate(new v(e,f?t:a))})),n}}o.propagate(new v(i,n,e.left.property)),ge(o),"FunctionExpression"==e.right.type&&o.propagate(e.right.scope.fnType.self,2)}else he(e.left,t,n);return n})),LogicalExpression:be((function(e,t,r){xe(e.left,t,r),xe(e.right,t,r)})),ConditionalExpression:be((function(e,t,r){xe(e.test,t,a),xe(e.consequent,t,r),xe(e.alternate,t,r)})),NewExpression:be((function(e,t,r,n){"Identifier"==e.callee.type&&e.callee.name in t.props&&Z(t,20);for(var i=0,o=[];i<e.arguments.length;++i)o.push(xe(e.arguments[i],t));var s=xe(e.callee,t),a=new f;s.propagate(new x(a,n&&/\.prototype$/.test(n))),a.propagate(r,90),s.propagate(new b(a,o,e.arguments,new j(r)))})),CallExpression:be((function(e,t,r){for(var n=0,i=[];n<e.arguments.length;++n)i.push(xe(e.arguments[n],t));var o=W(t).fnType;if("MemberExpression"==e.callee.type){var s=xe(e.callee.object,t),a=oe(e.callee,t);o&&("call"==a||"apply"==a)&&o.args.indexOf(s)>-1&&Z(t,30),s.propagate(new w(a,i,e.arguments,r))}else if("Super"==e.callee.type&&_.curSuperCtor)e.callee.superType=_.curSuperCtor,_.curSuperCtor.propagate(new b(de(t),i,e.arguments,r)),de(t).propagate(r,90);else{var p=xe(e.callee,t);o&&o.args.indexOf(p)>-1&&Z(t,30);var u=p.getFunctionType();u&&u.instantiateScore&&o&&Z(t,u.instantiateScore/5),p.propagate(new b(_.topScope,i,e.arguments,r))}})),AwaitExpression:be((function(e,t,r,n){var i=xe(e.argument,t,null,n),o=i.getType();o&&o.constructor==D&&"Promise"==o.name?o.hasProp(":t")&&o.getProp(":t").propagate(r):i.propagate(r)})),MemberExpression:be((function(e,t,r){var n,i=oe(e);if("<i>"==i){var o=xe(e.property,t),s=se(o);s?i=e.propName=s:o.hasType(_.num)||(n=6)}xe(e.object,t).getProp(i).propagate(r,n)})),Identifier:me((function(e,t){if("arguments"==e.name){var r=W(t,!1);r.fnType&&!(e.name in r.props)&&r.defProp(e.name,r.fnType.originNode).addType(new R(r.fnType.arguments=new f))}return t.getProp(e.name)})),ThisExpression:me((function(e,t){return de(t)})),Super:me((function(e){return e.superType=_.curSuper||a})),Literal:me((function(e){return ue(e)})),TemplateLiteral:me((function(e,t){for(var r=0;r<e.expressions.length;++r)xe(e.expressions[r],t,a);return _.str})),TaggedTemplateExpression:be((function(e,t,r){for(var n=[new R(_.str)],i=0;i<e.quasi.expressions.length;++i)n.push(xe(e.quasi.expressions[i],t));xe(e.tag,t,new b(_.topScope,n,e.quasi.expressions,r))})),YieldExpression:me((function(e,t){var r=a,n=W(t).fnType;return n&&(n.retval==a&&(n.retval=new f),n.yieldval||(n.yieldval=new f),r=n.retval),e.argument&&(e.delegate?xe(e.argument,t,new w("next",[],null,new y("value",r))):xe(e.argument,t,r)),n?n.yieldval:a}))};function xe(e,t,r,n){var i=we[e.type];return i?i(e,t,r,n):a}function Pe(e){return"VariableDeclaration"==e.type?e.declarations[0].id:e}we.ArrowFunctionExpression=we.FunctionExpression;var Te=e.inferWrapper=n.make({Expression:function(e,t){xe(e,e.scope||t,a)},ObjectExpression:function(e,t){xe(e,e.scope||t,a)},FunctionDeclaration:function(e,t,r){var n=e.scope,i=n.fnType;fe(e,n),r(e.body,n,"Statement"),Q(e,i)||Y(i),e.id&&t.getProp(e.id.name).addType(i)},Statement:function(e,t,r){r(e,e.scope||t)},ExportDefaultDeclaration:function(e,t,r){r(e.declaration,e.scope||t)},VariableDeclaration:function(e,t){for(var r=0;r<e.declarations.length;++r){var n=e.declarations[r];if("Identifier"==n.id.type){var i=t.getProp(n.id.name);n.init&&xe(n.init,t,i,n.id.name)}else n.init&&he(n.id,t,xe(n.init,t))}},ClassDeclaration:function(e,t){e.id?t.getProp(e.id.name).addType(ye(e,t,e.id.name)):ye(e,t)},ReturnStatement:function(e,t){if(e.argument){var r=a,n=W(t).fnType;n&&(n.retval==a&&(n.retval=new f),r=n.retval),xe(e.argument,t,r)}},ForInStatement:function(e,t,r){var n=xe(e.right,t);if("Identifier"==e.right.type&&e.right.name in t.props||"MemberExpression"==e.right.type&&"prototype"==e.right.property.name){Z(t,5);var i=Pe(e.left);"Identifier"==i.type?(i.name in t.props&&(t.getProp(i.name).iteratesOver=n),n.getProp("<i>").propagate(le(i,t))):he(i,t,n.getProp("<i>"))}r(e.body,t,"Statement")},ForOfStatement:function(e,t,r){var n,i=Pe(e.left);"Identifier"==i.type?n=le(i,t):he(i,t,n=new f),e.await?xe(e.right,t,new w(":Symbol.asyncIterator",[],null,new w("next",[],null,new y(":t",new y("value",n))))):xe(e.right,t,new w(":Symbol.iterator",[],null,new w("next",[],null,new y("value",n)))),r(e.body,t,"Statement")}}),Ae=e.parse=function(e,n,i){var o;n&&!Array.isArray(n)||(n=i);try{o=t.parse(e,n)}catch(t){o=r.parse(e,n)}return o};function Oe(e,t,r){var n=_.definitions.ecmascript,i=new D(!0);i.defProp("done").addType(_.bool),t.propagate(i.defProp("value"));var o=i;r&&n&&(o=new D(n["Promise.prototype"])).getType().propagate(new v(":t",i));var s=new q(null,a,e?[e]:[],e?["?"]:[],o),p=new D(!n||(r?n.async_generator_prototype:n.generator_prototype));return p.defProp("next").addType(s),p}function je(e,t){return e.generator?e.computeRet?Oe(e.yieldval,t,e.async):(!0===e.generator&&(e.generator=Oe(e.yieldval,t,e.async)),e.generator):t}function Ee(e,t,r){var n=Fe(e,r).getFunctionType();if(!n)return a;var i=n.retval;if(n.computeRet){for(var o=0,s=[];o<t.length;++o)s.push(Fe(t[o],r));var p=a;"MemberExpression"==e.type&&(p=Fe(e.object,r)),i=n.computeRet(p,s,t)}return je(n,i)}e.analyze=function(t,r,i){"string"==typeof t&&(t=Ae(t)),r||(r="file#"+_.origins.length),e.addOrigin(_.curOrigin=r),i||(i=_.topScope),_.startAnalysis(),n.recursive(t,i,null,re),_.parent&&_.parent.signal("preInfer",t,i),n.recursive(t,i,null,Te),_.parent&&_.parent.signal("postInfer",t,i),_.curOrigin=null},e.purge=function(e,t,r){var n=function(e,t,r){var n=Array.isArray(e);return n&&1==e.length&&(e=e[0],n=!1),n?null==r?function(t){return e.indexOf(t.origin)>-1}:function(n,i){return i&&i.start>=t&&i.end<=r&&e.indexOf(n.origin)>-1}:null==r?function(t){return t.origin==e}:function(n,i){return i&&i.start>=t&&i.end<=r&&n.origin==e}}(e,t,r);for(var i in++_.purgeGen,_.topScope.purge(n),_.props){for(var o=_.props[i],s=0;s<o.length;++s){var a=o[s].props[i];a&&!n(a,a.originNode)||o.splice(s--,1)}o.length||delete _.props[i]}},f.prototype.purge=function(e){if(this.purgeGen!=_.purgeGen){this.purgeGen=_.purgeGen;for(var t=0;t<this.types.length;++t){var r=this.types[t];e(r,r.originNode)?this.types.splice(t--,1):r.purge(e)}if(this.types.length||(this.maxWeight=0),this.forward)for(t=0;t<this.forward.length;++t){var n=this.forward[t];e(n)?(this.forward.splice(t--,1),this.props&&(this.props=null)):n.purge&&n.purge(e)}}},a.purge=function(){},D.prototype.purge=function(e){if(this.purgeGen==_.purgeGen)return!0;for(var t in this.purgeGen=_.purgeGen,this.props){var r=this.props[t];e(r,r.originNode)&&this.removeProp(t),r.purge(e)}},q.prototype.purge=function(e){if(!D.prototype.purge.call(this,e)){this.self.purge(e),this.retval.purge(e);for(var t=0;t<this.args.length;++t)this.args[t].purge(e)}};var Ne=e.typeFinder={ArrayExpression:function(e,t){return ve(e.elements,t,Fe)},ObjectExpression:function(e){return e.objType},ClassDeclaration:function(e){return e.objType},ClassExpression:function(e){return e.objType},FunctionDeclaration:function(e){return e.scope.fnType},FunctionExpression:function(e){return e.scope.fnType},ArrowFunctionExpression:function(e){return e.scope.fnType},SequenceExpression:function(e,t){return Fe(e.expressions[e.expressions.length-1],t)},UnaryExpression:function(e){return ae(e.operator)},UpdateExpression:function(){return _.num},BinaryExpression:function(e,t){if(pe(e.operator))return _.bool;if("+"==e.operator){var r=Fe(e.left,t),n=Fe(e.right,t);if(r.hasType(_.str)||n.hasType(_.str))return _.str}return _.num},AssignmentExpression:function(e,t){return Fe(e.right,t)},LogicalExpression:function(e,t){var r=Fe(e.left,t);return r.isEmpty()?Fe(e.right,t):r},ConditionalExpression:function(e,t){var r=Fe(e.consequent,t);return r.isEmpty()?Fe(e.alternate,t):r},NewExpression:function(e,t){var r=Fe(e.callee,t).getFunctionType(),n=r&&r.getProp("prototype").getObjType();return n?P(n,r):a},CallExpression:function(e,t){return Ee(e.callee,e.arguments,t)},MemberExpression:function(e,t){var r=oe(e),n=Fe(e.object,t).getType();return n?n.getProp(r):"<i>"==r?a:function(e){De=!0;var t=V(e);if(t)for(var r=0;r<t.length;++r){var n=t[r].getProp(e);if(!n.isEmpty())return n}return a}(r)},MethodDefinition:function(e){var t=oe(e),r=de(e.value.scope).getType();return r?r.getProp(t):a},Identifier:function(e,t){return t.hasProp(e.name)||a},ThisExpression:function(e,t){return de(t)},Literal:function(e){return ue(e)},Super:me((function(e){return e.superType})),TemplateLiteral:function(){return _.str},TaggedTemplateExpression:function(e,t){return Ee(e.tag,e.quasi.expressions,t)},YieldExpression:function(e,t){var r=W(t).fnType;return r?r.yieldval:a}};function Fe(e,t){var r=Ne[e.type];return r?r(e,t):a}var Ce=e.searchVisitor=n.make({Function:function(e,t,r){n.base.Function(e,e.scope,r)},CatchClause:function(e,t,r){n.base.CatchClause(e,e.scope,r)},Property:function(e,t,r){e.computed&&r(e.key,t,"Expression"),e.key!=e.value&&r(e.value,t,"Expression")},Statement:function(e,t,r){r(e,e.scope||t)},ImportSpecifier:function(e,t,r){r(e.local,t)},ImportDefaultSpecifier:function(e,t,r){r(e.local,t)},ImportNamespaceSpecifier:function(e,t,r){r(e.local,t)}}),Se=e.searchExprVisitor=n.make({MemberExpression:function(e,t,r){r(e.object,t,"Expression"),e.computed&&r(e.property,t,"Expression")},Property:function(e,t,r){e.computed&&r(e.key,t,"Expression"),r(e.value,t,"Expression")}},Ce);e.fullVisitor=n.make({MemberExpression:function(e,t,r){r(e.object,t,"Expression"),r(e.property,t,e.computed?"Expression":null)},Property:function(e,t,r){e.computed&&r(e.key,t,"Expression"),r(e.value,t,"Expression")}},Ce),e.findExpressionAt=function(e,t,r,i,o){var s=o||function(e,t){return("Identifier"!=t.type||"âœ–"!=t.name)&&Ne.hasOwnProperty(t.type)};return n.findNodeAt(e,t,r,s,Se,i||_.topScope)},e.findClosestExpression=function(e,t,r,i,o){var s=o||function(e,r){return!(null!=t&&r.start>t)&&("Identifier"!=r.type||"âœ–"!=r.name)&&Ne.hasOwnProperty(r.type)};return n.findNodeAround(e,r,s,Se,i||_.topScope)},e.findExpressionAround=function(e,t,r,i,o){var s=o||function(e,r){return!(null!=t&&r.start>t)&&("Identifier"!=r.type||"âœ–"!=r.name)&&Ne.hasOwnProperty(r.type)};return n.findNodeAround(e,r,s,Ce,i||_.topScope)},e.expressionType=function(e){return Fe(e.node,e.state)},e.parentNode=function(e,t){var r=[];try{!function t(i,o,s){if(i.start<=e.start&&i.end>=e.end){var a=r[r.length-1];if(i==e)throw{found:a};a!=i&&r.push(i),n.base[s||i.type](i,o,t),a!=i&&r.pop()}}(t,null)}catch(e){if(e.found)return e.found;throw e}};var ke=e.findTypeFromContext={ArrayExpression:function(e,t,r){return r(e,!0).getProp("<i>")},ObjectExpression:function(e,t,r){for(var n=0;n<e.properties.length;++n){var i=t.properties[n];if(i.value==t)return r(e,!0).getProp(oe(i))}},UnaryExpression:function(e){return ae(e.operator)},UpdateExpression:function(){return _.num},BinaryExpression:function(e){return pe(e.operator)?_.bool:_.num},AssignmentExpression:function(e,t,r){return r(e.left)},LogicalExpression:function(e,t,r){return r(e,!0)},ConditionalExpression:function(e,t,r){if(e.consequent==t||e.alternate==t)return r(e,!0)},CallExpression:function(e,t,r){for(var n=0;n<e.arguments.length;n++)if(e.arguments[n]==t){var i=r(e.callee).getFunctionType();if(i instanceof q)return i.args[n];break}},ReturnStatement:function(e,t,r){var i=n.findNodeAround(t.sourceFile.ast,t.start-1,"Function");if(i){var o="FunctionDeclaration"!=i.node.type?r(i.node,!0).getFunctionType():i.node.scope.fnType;if(o)return o.retval.getType()}},VariableDeclarator:function(e,t,r){if(e.init==t)return r(e.id)}};ke.NewExpression=ke.CallExpression,e.typeFromContext=function(t,r){var n=e.parentNode(r.node,t),i=null;if(ke.hasOwnProperty(n.type)){var o=ke[n.type];i=o&&o(n,r.node,(function(n,i){var o={node:n,state:r.state};return(i?e.typeFromContext(t,o):e.expressionType(o))||a}))}return i||e.expressionType(r)};var De=!1;e.resetGuessing=function(e){De=e},e.didGuess=function(){return De},e.forAllPropertiesOf=function(e,t){e.gatherProperties(t,0)},e.findRefs=function(t,r,i,o,s){function a(e,r,n){var a=n[n.length-2];if(("MemberExpression"!=a.type||a.computed||!e.object)&&e.name==i&&(e!=t.id||"FunctionDeclaration"!=t.type)&&a.property!==e)for(var p=r;p;p=p.prev)if(p==o&&s(e,r,n),i in p.props)return}n.ancestor(t,{Identifier:a,VariablePattern:a},e.fullVisitor,r)};var Ie=n.make({Function:function(e,t,r){r(e.body,e.scope,e.expression?"Expression":"Statement")},Statement:function(e,t,r){r(e,e.scope||t)}});e.findPropRefs=function(e,t,r,i,o){for(;r&&!r.props[i]&&(!r.maybeProps||!r.maybeProps[i]);)r=r.proto;if(!r)throw new Error("Couldn't locate property in the base object type.");function s(e){for(;e&&e!=r;){if(e.props[i]||e.maybeProps&&e.maybeProps[i])return!1;e=e.proto}return e}n.simple(e,{MemberExpression:function(e,t){e.computed||oe(e)!=i||s(Fe(e.object,t).getType())&&o(e.property,t)},ObjectExpression:function(e,t){if(Fe(e,t).getType()==r)for(var n=0;n<e.properties.length;++n)oe(e.properties[n])==i&&o(e.properties[n].key,t)},MethodDefinition:function(e){oe(e)==i&&e.value&&s(de(e.value.scope).getType())&&o(e.key,e.value.scope)}},Ie,t)};var Me=e.scopeAt=function(e,t,r){var i=n.findNodeAround(e,t,(function(e,t){return t.scope}));return i?i.node.scope:r||_.topScope};e.forAllLocalsAt=function(e,t,r,n){Me(e,t,r).gatherProperties(n,0)},i=e.def=i.init({},e)})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../lib/infer"),require("../lib/tern"),require("../lib/comment"),require("acorn"),require("acorn-walk")):"function"==typeof define&&define.amd?define(["../lib/infer","../lib/tern","../lib/comment","acorn/dist/acorn","acorn-walk/dist/walk"],e):e(tern,tern,tern.comment,acorn,acorn.walk)}((function(e,t,r,n,i){"use strict";var o=1;function s(e,t){function n(e){r.ensureCommentsBefore(t,e)}i.simple(e,{VariableDeclaration:n,FunctionDeclaration:n,MethodDefinition:n,Property:n,AssignmentExpression:function(e){"="==e.operator&&n(e)},CallExpression:function(e){a(e)&&n(e)},ExportNamedDeclaration:n,ExportDefaultDeclaration:n,ClassDeclaration:n})}function a(e){return"MemberExpression"==e.callee.type&&"Object"==e.callee.object.name&&"defineProperty"==e.callee.property.name&&e.arguments.length>=3&&"string"==typeof e.arguments[1].value}function p(t,r){!function(t,r){for(var n,i=e.cx(),o=/\s@typedef\s+(.*)/g;n=o.exec(t);){var s=m(r,n[1]),a=s&&n[1].slice(s.end).match(/^\s*(\S+)/);if(a&&s.type instanceof e.Obj){for(var p=t.slice(n.index+n[0].length);n=/\s+@prop(?:erty)?\s+(.*)/.exec(p);){var u,f=m(r,n[1]);f&&(u=n[1].slice(f.end).match(/^\s*(\S+)/))&&f.type.propagate(s.type.defProp(u[1])),p=p.slice(n[0].length)}i.parent.mod.jsdocTypedefs[a[1]]=s.type}}}(t.sourceFile.text,r),i.simple(t,{VariableDeclaration:function(e,t){var r=e.declarations[0].id;e.commentsBefore&&"Identifier"==r.type&&l(e,e.commentsBefore,t,t.getProp(e.declarations[0].id.name))},FunctionDeclaration:function(e,t){e.commentsBefore&&l(e,e.commentsBefore,t,t.getProp(e.id.name),e.scope.fnType)},ClassDeclaration:function(e,t){e.commentsBefore&&l(e,e.commentsBefore,t,t.getProp(e.id.name),e.objType)},AssignmentExpression:function(t,r){t.commentsBefore&&l(t,t.commentsBefore,r,e.expressionType({node:t.left,state:r}))},ObjectExpression:function(t,r){for(var n=0;n<t.properties.length;++n){var i=t.properties[n];if("SpreadElement"!=i.type){var o=e.propName(i);"<i>"!=o&&i.commentsBefore&&l(i,i.commentsBefore,r,t.objType.getProp(o))}}},Class:function(t,r){if(t.objType){var n=t.objType.getProp("prototype").getObjType();if(n)for(var i=0;i<t.body.body.length;i++){var o,s=t.body.body[i];s.commentsBefore&&("constructor"==s.kind?l(s,s.commentsBefore,r,t.objType):"<i>"!=(o=e.propName(s))&&l(s,s.commentsBefore,r,n.getProp(o)))}}},CallExpression:function(t,r){if(t.commentsBefore&&a(t)){var n=e.expressionType({node:t.arguments[0],state:r}).getObjType();if(n&&n instanceof e.Obj){var i=n.props[t.arguments[1].value];i&&l(t,t.commentsBefore,r,i)}}},ExportNamedDeclaration:function(e,t){e.commentsBefore&&e.declaration&&"FunctionDeclaration"===e.declaration.type&&l(e.declaration,e.commentsBefore,t,t.getProp(e.declaration.id.name),e.declaration.scope.fnType)},ExportDefaultDeclaration:function(e,t){e.commentsBefore&&e.declaration&&"FunctionDeclaration"===e.declaration.type&&l(e.declaration,e.commentsBefore,t,t.getProp(e.declaration.id.name),e.declaration.scope.fnType)}},e.searchVisitor,r)}function u(t){var r=t["!typedef"],n=e.cx(),i=t["!name"];if(r)for(var o in r)n.parent.mod.jsdocTypedefs[o]=v(e.def.parse(r[o],i,o),o)}function f(e){for(var t,r=1;r<e.length;r++){var n=e[r],i=n.match(/^[\s\*]*/)[0];if(i!=n)if(null==t)t=i;else{for(var o=0;o<t.length&&t.charCodeAt(o)==i.charCodeAt(o);)++o;o<t.length&&(t=t.slice(0,o))}}for(e=e.map((function(e,r){if(e=e.replace(/\s+$/,""),0==r&&null!=t)for(var n=0;n<t.length;n++)if(0==e.indexOf(t.slice(n)))return e.slice(t.length-n);return null==t||0==r?e.replace(/^[\s\*]*/,""):e.length<t.length?"":e.slice(t.length)}));e.length&&!e[e.length-1];)e.pop();for(;e.length&&!e[0];)e.shift();return e}function l(t,r,n,i,o){!function(t,r,n,i){for(var o,s,a,p,u,f,l=0;l<i.length;++l)for(var c,h=i[l],d=/(?:\n|\*)\s*@(type|param|arg(?:ument)?|returns?|this|class|constructor)(?:\s*?\n|\s+(.*))/g;c=d.exec(h);)if("class"!=c[1]&&"constructor"!=c[1]){if(void 0!==c[2])if("this"==c[1]&&(f=y(r,c[2],0)))u=f,p=!0;else if(f=m(r,c[2]))switch(p=!0,c[1]){case"returns":case"return":a=f;break;case"type":o=f;break;case"param":case"arg":case"argument":var g=c[2].slice(f.end).match(/^\s*(\[?)\s*([^\[\]\s=]+(\[\][^\[\]\s=]+)?)\s*(?:=[^\]]+\s*)?(\]?).*/);if(!g)continue;var v=g[2]+(f.isOptional||"["===g[1]&&"]"===g[4]?"?":""),x=!1,P=v.split(".");if(s&&2==P.length){var T,A,O=P[0];for(T in v=P[1],s)A=s[T],T===O&&A.type instanceof e.Obj?(x=!0,f.type.propagate(A.type.defProp(v))):T+"[]"===O&&A.type instanceof e.Arr&&(x=!0,f.type.propagate(A.type.getProp("<i>").getType().defProp(v)))}x||((s||(s=Object.create(null)))[v]=f)}}else u=p=!0;p&&function(t,r,n,i,o,s){var a;if("VariableDeclaration"==o.type){var p=o.declarations[0];p.init&&w(p.init)&&(a=p.init.scope.fnType)}else"FunctionDeclaration"==o.type?a=o.scope.fnType:"AssignmentExpression"==o.type?w(o.right)&&(a=o.right.scope.fnType):"CallExpression"==o.type||"ClassDeclaration"===o.type||w(o.value)&&(a=o.value.scope.fnType);if(a&&(n||i||r)){if(n)for(var u=0;u<a.argNames.length;++u){var f=a.argNames[u],l=n[f];!l&&(l=n[f+"?"])&&(a.argNames[u]+="?"),l&&b(l,a.args[u])}if(i&&(a.retval==e.ANull&&(a.retval=new e.AVal),b(i,a.retval)),!0===r){var c=a.getProp("prototype").getObjType();r=c&&{type:e.getInstance(c,a)}}r&&b(r,a.self)}else t&&b(t,s)}(o,u,s,a,t,n)}(t,n,i,r);var s=e.cx();!o&&i instanceof e.AVal&&i.types.length&&((o=i.types[i.types.length-1])instanceof e.Obj&&o.origin==s.curOrigin&&!o.doc||(o=null));for(var a=r.length-1;a>=0;a--){var p=f(r[a].split(/\r\n?|\n/)).join("\n");if(p){i instanceof e.AVal&&(i.doc=p),o&&(o.doc=p);break}}}function c(e,t){for(;/\s/.test(e.charAt(t));)++t;return t}function h(e){if(!n.isIdentifierStart(e.charCodeAt(0)))return!1;for(var t=1;t<e.length;t++)if(!n.isIdentifierChar(e.charCodeAt(t)))return!1;return!0}function d(e,t,r,n){for(var i=[],o=[],s=!1,a=!0;r=c(t,r),!a||t.charAt(r)!=n;a=!1){var p=t.indexOf(":",r);if(p<0)return null;var u=t.slice(r,p);if(!h(u))return null;i.push(u);var f=y(e,t,r=p+1);if(!f)return null;r=f.end,s=s||f.madeUp,o.push(f.type),r=c(t,r);var l=t.charAt(r);if(++r,l==n)break;if(","!=l)return null}return{labels:i,types:o,end:r,madeUp:s}}function g(t,r,i){var o=function(t,r,i){i=c(r,i),/[?!]/.test(r.charAt(i))&&i++;var o,s=!1;if(r.indexOf("function(",i)==i){var a=d(t,r,i+9,")"),p=e.ANull;if(!a)return null;if(i=c(r,a.end),":"==r.charAt(i)){var u=y(t,r,1+ ++i);if(!u)return null;i=u.end,p=u.type,s=u.madeUp}o=new e.Fn(null,e.ANull,a.types,a.labels,p)}else if("["==r.charAt(i)){if(!(b=y(t,r,i+1)))return null;if(i=c(r,b.end),s=b.madeUp,"]"!=r.charAt(i))return null;++i,o=new e.Arr(b.type)}else if("{"==r.charAt(i)){var f=d(t,r,i+1,"}");if(!f)return null;o=new e.Obj(!0);for(var l=0;l<f.types.length;++l){var h=o.defProp(f.labels[l]);h.initializer=!0,f.types[l].propagate(h)}i=f.end,s=f.madeUp}else if("("==r.charAt(i)){if(!(b=y(t,r,i+1)))return null;if(i=c(r,b.end),")"!=r.charAt(i))return null;++i,o=b.type}else{var g=i;if(!n.isIdentifierStart(r.charCodeAt(i)))return null;for(;n.isIdentifierChar(r.charCodeAt(i));)++i;if(g==i)return null;var m=r.slice(g,i);if(/^(number|integer)$/i.test(m))o=e.cx().num;else if(/^bool(ean)?$/i.test(m))o=e.cx().bool;else if(/^string$/i.test(m))o=e.cx().str;else if(/^(null|undefined)$/i.test(m))o=e.ANull;else if(/^array$/i.test(m)){var b=null;if("."==r.charAt(i)&&"<"==r.charAt(i+1)){var w=y(t,r,i+2);if(!w)return null;if(i=c(r,w.end),s=w.madeUp,">"!=r.charAt(i++))return null;b=w.type}o=new e.Arr(b)}else if(/^object$/i.test(m)){if(o=new e.Obj(!0),"."==r.charAt(i)&&"<"==r.charAt(i+1)){var x=y(t,r,i+2);if(!x)return null;if(i=c(r,x.end),","!=r.charAt(i++))return null;var P=y(t,r,i);if(!P)return null;if(i=c(r,P.end),s=x.madeUp||P.madeUp,">"!=r.charAt(i++))return null;P.type.propagate(o.defProp("<i>"))}}else{for(;46==r.charCodeAt(i)||n.isIdentifierChar(r.charCodeAt(i));)++i;var T,A=r.slice(g,i),O=e.cx(),j=O.parent&&O.parent.mod.jsdocTypedefs;j&&A in j?o=j[A]:(T=e.def.parsePath(A,t).getObjType())?o=v(T,A):(O.jsdocPlaceholders||(O.jsdocPlaceholders=Object.create(null)),o=A in O.jsdocPlaceholders?O.jsdocPlaceholders[A]:O.jsdocPlaceholders[A]=new e.Obj(null,A),s=!0)}}return{type:o,end:i,madeUp:s}}(t,r,i);return o?"[]"==r.slice(o.end,o.end+2)?{madeUp:o.madeUp,end:o.end+2,type:new e.Arr(o.type)}:o:null}function y(t,r,n){for(var i,o=!1,s=!1;;){var a=g(t,r,n);if(!a)return null;if(s=s||a.madeUp,o?a.type.propagate(o):i=a.type,n=c(r,a.end),"|"!=r.charAt(n))break;n++,o||(o=new e.AVal,i.propagate(o),i=o)}var p=!1;return"="==r.charAt(n)&&(++n,p=!0),{type:i,end:n,isOptional:p,madeUp:s}}function v(t,r){if(t instanceof e.Fn&&/(?:^|\.)[A-Z][^\.]*$/.test(r)){var n=t.getProp("prototype").getObjType();if(n instanceof e.Obj)return e.getInstance(n)}return t}function m(e,t,r){if(r=c(t,r||0),"{"!=t.charAt(r))return null;var n=y(e,t,r+1);if(!n)return null;var i=c(t,n.end);return"}"!=t.charAt(i)?null:(n.end=i+1,n)}function b(t,r){var n=e.cx().parent.mod.docComment.weight;t.type.propagate(r,n||(t.madeUp?o:void 0))}function w(e){return"FunctionExpression"==e.type||"ArrowFunctionExpression"==e.type}t.registerPlugin("doc_comment",(function(e,t){e.mod.jsdocTypedefs=Object.create(null),e.on("reset",(function(){e.mod.jsdocTypedefs=Object.create(null)})),e.mod.docComment={weight:t&&t.strong?101:void 0,fullDocs:t&&t.fullDocs},e.on("postParse",s),e.on("postInfer",p),e.on("postLoadDef",u)}))}));